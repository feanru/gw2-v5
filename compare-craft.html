<!DOCTYPE html>
<html lang="es">
<head>
  <meta name="app-version" content="1.0.0">
  <script>window.__APP_VERSION__='1.0.0';</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/img/favicon.ico" sizes="16x16" type="image/x-icon">
  <title>Comparador de Costes de Crafteo – Herramienta GW2</title>
  <link integrity="sha256-3KTGYB1FxMzkVqLV4zcAvVqwAMJWbsPxPT44jS0fUXk= sha384-oOV6TGLGOB+l2btdKi1rjgcdp5GrniPY9tUpd1v1UqfZHQcCV9yb7nrrf7ls9S9n" crossorigin="anonymous" rel="stylesheet" href="css/global-gw.css?v=1.0.0">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1YJ4M39JP3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1YJ4M39JP3');
</script>
</head>
<body>
  <header>
    <!-- El menú de navegación se insertará aquí automáticamente -->
  </header>
  <section class="services-menu">
    <div class="menu-grid-craft">
      <a href="#" class="menu-card-search-craft" id="open-search-modal">
        <div class="card-icon-craft">
          <img src="img/search.svg" alt="Buscador">
        </div>
        <div class="card-title">Buscador</div>
      </a>

    </div>
  </section>
  <div class="container">
    <div class="center-mb-25">
      <h2>Comparativa de items</h2>
      <p>Busca y añade items para comprar sus precios de crafteo y profit</p>
    </div>

    <div class="qty-global-container qty-controls">
      <div>
        <label for="qty-global" class="fw-500">Cantidad global:</label>
        <input id="qty-global" type="number" min="1" value="1" autocomplete="off">
      </div>
      <button id="btn-guardar-comparativa" class="tab-button ml-10" data-requires-login="true">Guardar comparativa</button>
    </div>

    <div id="item-header"></div>    

    <main>
      <!-- Secciones de Tabs -->
      
      
      <div id="error-message" class="error-message hidden"></div>
      <div id="wiki-links" class="hidden"></div>
      
      

      
      
      <div id="seccion-crafting"></div>
      <div id="item-skeleton" class="hidden">
        <div class="skeleton skeleton-result-line"></div>
        <div class="skeleton skeleton-result-line"></div>
        <div class="skeleton skeleton-result-line"></div>
        <div class="skeleton skeleton-result-line"></div>
        <div class="skeleton skeleton-result-line"></div>
      </div>
    </main>

  </div>


  
  <script type="module" src="/dist/1.0.0/bundle-utils-1.By0Xs4MH.min.js?v=1.0.0" defer></script>

  <!-- Modal del Buscador fuera de .container para igualar a index.html -->
  <div id="search-modal" class="search-modal hidden">
    <div class="search-modal-backdrop"></div>
    <div class="search-modal-content">
      <button class="close-modal" id="close-search-modal"></button>
      <input type="text" id="modal-search-input" placeholder="Buscar ítem por nombre..." autocomplete="off">
      <ul id="modal-suggestions" class="suggestions"></ul>
      <div id="modal-skeleton" class="hidden">
        <div class="skeleton skeleton-result-line"></div>
        <div class="skeleton skeleton-result-line"></div>
        <div class="skeleton skeleton-result-line"></div>
        <div class="skeleton skeleton-result-line"></div>
        <div class="skeleton skeleton-result-line"></div>
      </div>
      <div id="modal-error-message" class="error-message hidden"></div>
      <div id="modal-results" class="item-list"></div>
    </div>
  </div>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const openBtn = document.getElementById('open-search-modal');
    const modal = document.getElementById('search-modal');
    const closeBtn = document.getElementById('close-search-modal');
    openBtn.addEventListener('click', function(e) {
      e.preventDefault();
      openSearchModal(`/dist/1.0.0/search-modal-compare-craft.DMluxb5J.min.js?v=1.0.0`);
    });
    closeBtn.addEventListener('click', closeSearchModal);
    modal.querySelector('.search-modal-backdrop').addEventListener('click', closeSearchModal);
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeSearchModal();
    });
  });
  </script>

  <script integrity="sha256-n9vuMHTjc3Bz7l5eMUAVC7G/4oH4KJKHkO6j6qy6Htc= sha384-ghFYGAwmFj8Fikh2GjTW7EmaYAnxc50x86vrdykhiZokEd4axHbupCRyUaD4JmJ3" crossorigin="anonymous" type="module" src="/dist/1.0.0/tabs.DUiiG-cO.min.js?v=1.0.0" defer></script>
  <script integrity="sha256-lI9oVF3rASkTQT+Q61UOQ0AUQzlaW01lIGKSD3xqr3U= sha384-mnOWuhTgdS+hboWVDRPJtSf49cr2Iw4uAbmZiKeGn7VutpeMp7rcXjVjBM5ZUsDe" crossorigin="anonymous" type="module" src="/dist/1.0.0/feedback-modal.BaGBwUid.min.js?v=1.0.0" defer></script>
  <!-- Nuevos módulos separados -->
  <script type="module" src="/dist/1.0.0/items-core.DMXEDbc5.min.js?v=1.0.0" defer></script>
  <script integrity="sha256-d9mvLRL8NjISih0TQPBqFaRo81VSiPOQxKXF/qP2t0I= sha384-Qi7QqamR+8RIzR8mbh+svlZoFN59uLBp/Hj1014q9baL+A7Ty79LeYbgezanWEJq" crossorigin="anonymous" type="module" src="/dist/1.0.0/ui-helpers.min.js?v=1.0.0" defer></script>
  <script integrity="sha256-7wNGhZMJNHw4jah66yLsxz60CcR2m771STVbxRVabas= sha384-pBGxTvSWNIa/GzyiKkmL7Q6wG2sTd07oMK6HjycVB798mHQJeM3qo4/vq0GgY4vx" crossorigin="anonymous" type="module" src="/dist/1.0.0/compare-ui.min.js?v=1.0.0" defer></script>

  <script>
  // Override global de selectItem para integración con el modal en compare-craft
  window.selectItem = function(id, e) {
  if (e) e.preventDefault();
  if (window.comparativa && typeof window.comparativa.agregarItemPorId === 'function') {
    window.comparativa.agregarItemPorId(Number(id));
    var input = document.getElementById('modal-search-input');
    var suggestions = document.getElementById('modal-suggestions');
    var results = document.getElementById('modal-results');
    if (input) input.value = '';
    if (suggestions) suggestions.innerHTML = '';
    if (results) results.innerHTML = '';
    if (input) input.focus();
    return false;
  }
  // Aquí puedes mostrar un mensaje de error visualmente, por consola, etc.
  alert('No se pudo agregar el ítem a la comparativa. Por favor intenta de nuevo.');
  // O si prefieres un mensaje en pantalla:
  var error = document.getElementById('modal-error-message');
  if (error) {
    error.textContent = 'No se pudo agregar el ítem a la comparativa.';
    error.style.display = 'block';
  }
  return false;
};

  </script>
<script type="module" src="/dist/1.0.0/bundle-auth-nav.CyOGHb8A.min.js?v=1.0.0" defer></script>
<script>
  // Inicializar autenticación cuando el DOM esté listo
  document.addEventListener('DOMContentLoaded', function() {
    if (window.Auth && typeof window.Auth.initAuth === 'function') {
      window.Auth.initAuth();
    }
  });
</script>

<script integrity="sha256-pO+Byb88oCke+8yWLDiOFWLL7ad86Ub70Cm/fK8Zzf8= sha384-YKNxan27Ley6vqB0N1p0S2Qj1BYPLnjVrKUxdfJHSu70QfR1tm6xxrva/FnBkclF" crossorigin="anonymous" type="module" src="/dist/1.0.0/storageUtils.min.js?v=1.0.0" defer></script>
<!-- Manejadores de comparativa (guardar comparativa) -->
<script integrity="sha256-i5SntiDN4SX4OUvCC10gdH7sgi3Tnbc2huYtVIUbqao= sha384-vPaa8Cx1/J7bSLZqIkceoOrIVuI9BaPwT1AaExDm42hyru/cPqVkJeJk3Q+D/oDN" crossorigin="anonymous" type="module" src="/dist/1.0.0/compareHandlers.min.js?v=1.0.0" defer></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    if (window.comparativa &&
        typeof window.comparativa.loadComparativaFromURL === 'function') {
      window.comparativa.loadComparativaFromURL();
    }
  });
</script>
  <script integrity="sha256-epP+lCI5WCrWowRjjnwKQ+kf/Qn0kQVopctTDus7yyc= sha384-8Qw36KVUjd1eSKi7U8pR5BeFBZDEYIjTdn+fxRNe1InH4zy9+Ggl9382PhZrlpf7" crossorigin="anonymous" type="module" src="/dist/1.0.0/sw-register.Wot8iBZe.min.js?v=1.0.0"></script>
</body>
</html>
