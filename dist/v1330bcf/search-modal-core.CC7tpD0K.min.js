import{f as e,r as t}from"./utils-BH_A_QOU.js";import"./services-BkFipzNj.js";function n(n={}){const{onSelect:i=function(e){},formatPrice:s=null,useSuggestions:o=!1}=n,l=document.getElementById("modal-search-input"),a=document.getElementById("modal-suggestions"),r=document.getElementById("modal-results"),d=document.getElementById("modal-skeleton"),c=document.getElementById("modal-error-message");let m=[];const u={},p={};function y(e){d&&d.classList.toggle("hidden",!e)}async function f(){const t=sessionStorage.getItem("itemList");if(t)m=JSON.parse(t);else{c&&(c.style.display="none");try{const[t,n]=await Promise.all([e("https://api.datawars2.ie/gw2/v1/items/json?fields=id,name_es"),e("https://api.datawars2.ie/gw2/v1/items/csv?fields=buy_price,sell_price,buy_quantity,sell_quantity,last_updated,1d_buy_sold,1d_sell_sold,2d_buy_sold,2d_sell_sold,7d_buy_sold,7d_sell_sold,1m_buy_sold,1m_sell_sold")]),[i,s]=await Promise.all([t.json(),n.text()]),o=s.trim().split("\n"),l=o[0].split(","),a=o.slice(1).map(e=>{const t=e.split(","),n={};return l.forEach((e,i)=>{n[e]="last_updated"===e?t[i]||"-":""!==t[i]?parseInt(t[i],10):null}),n}),r={};a.forEach(e=>{r[Number(e.id)]=e}),m=i.map(e=>({...e,...r[Number(e.id)]||{}})),sessionStorage.setItem("itemList",JSON.stringify(m))}catch(e){n="No se pudieron cargar los ítems.",c&&(c.textContent=n,c.style.display="block")}var n}}function g(e,t=!1){if(!r)return;if(r.innerHTML="",!e.length&&t)return void(r.innerHTML='<div class="error-message">No se encontraron ítems.</div>');const n=document.createDocumentFragment();e.forEach(e=>{const t=document.createElement("div");t.className="item-card",t.onclick=t=>i(e.id,t);const o="function"==typeof getRarityClass?getRarityClass(p[e.id]):"",l=s?s(e.buy_price):e.buy_price||0,a=s?s(e.sell_price):e.sell_price||0;t.innerHTML=`\n      <img src="${u[e.id]||""}" alt=""/>\n      <div class="item-name ${o}">${e.name_es}</div>\n      <div class="item-price" style="display:none;">Compra: ${l} | Venta: ${a}</div>\n    `,n.appendChild(t)}),r.appendChild(n)}function _(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}l&&l.addEventListener("input",function(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>e.apply(this,i),t)}}(async function(){const e=this.value.trim().toLowerCase();if(e.length<3)return o&&a&&(a.style.display="none"),r&&(r.innerHTML=""),void y(!1);y(!0);const n=_(e);let s=m.filter(e=>e.name_es&&_(e.name_es).includes(n));s=s.slice(0,30);const l=s.filter(e=>!u[e.id]).map(e=>e.id);l.length&&await async function(e){if(e.length)try{(await t(e)).forEach(e=>{e&&(u[e.id]=e.icon,p[e.id]=e.rarity)})}catch{}}(l),y(!1),function(e){if(!o)return void(a&&(a.innerHTML="",a.style.display="none"));if(!a)return;if(a.innerHTML="",!e.length)return void(a.style.display="none");const t=document.createDocumentFragment();e.forEach(e=>{const n=document.createElement("li");n.textContent=e.name_es,n.onclick=()=>i(e.id),t.appendChild(n)}),a.appendChild(t),a.style.display="block"}(s),g(s,!0)},250)),async function(){y(!0),await f(),g([]),y(!1)}()}"undefined"!=typeof window&&(window.initSearchModal=n),"undefined"!=typeof module&&module.exports&&(module.exports.initSearchModal=n);
