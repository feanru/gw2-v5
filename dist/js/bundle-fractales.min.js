const e={},t={};async function o(e=[]){if(!e||0===e.length)return{};const t=`https://api.datawars2.ie/gw2/v1/items/csv?fields=id,buy_price,sell_price&ids=${e.join(",")}`;try{const e=await fetch(t).then(e=>e.text()),[o,...a]=e.trim().split("\n"),n=o.split(","),i=n.indexOf("id"),r=n.indexOf("buy_price"),d=n.indexOf("sell_price"),s={};return a.forEach(e=>{const t=e.split(","),o=parseInt(t[i],10);isNaN(o)||(s[o]={buy_price:parseInt(t[r],10)||0,sell_price:parseInt(t[d],10)||0})}),s}catch(e){return{}}}"undefined"!=typeof window&&(window.FractalesUtils={fetchIconsFor:async function(o=[]){if(o.length)try{const a=await fetch(`https://api.guildwars2.com/v2/items?ids=${o.join(",")}&lang=es`);(await a.json()).forEach(o=>{o&&o.id&&(e[o.id]=o.icon,t[o.id]=o.rarity)})}catch{}},fetchItemPrices:o,iconCache:e,rarityCache:t});const a=[{key:"hueso",id:24341,nombre:"Hueso grande"},{key:"veneno",id:24282,nombre:"Vesícula de veneno potente"},{key:"polvo",id:24276,nombre:"Montón de polvo incandescente"},{key:"totem",id:24299,nombre:"Tótem intrincado"},{key:"garra",id:24350,nombre:"Garra grande"},{key:"colmillo",id:24356,nombre:"Colmillo grande"},{key:"sangre",id:24294,nombre:"Vial de sangre potente"},{key:"escama",id:24288,nombre:"Escama grande"},{key:"infusion_mas1",id:49424,nombre:"Infusión +1"}],n=[{stacks:55,data:{oro_de_basura:5951e4,garra:4625.45,totem:4360.23,sangre:5005.12,veneno:4610.56,hueso:4685.78,escama:4750.98,colmillo:4845.01,polvo:4855.34,infusion_mas1:31039.56,llaves_encriptacion:1426.12,"empíreos":8445.67}},{stacks:17,data:{oro_de_basura:18068500,garra:1340.23,totem:1640.45,sangre:1385.12,veneno:1475.56,hueso:1380.78,escama:1585.98,colmillo:1295.01,polvo:1540.34,infusion_mas1:9799.56,llaves_encriptacion:427.12,"empíreos":4125.67}},{stacks:32,data:{oro_de_basura:34443500,recetas_ascendentes:65.23,infusion_mas1:18256.56,llaves_encriptacion:783.12,hueso:2685.78,veneno:2775.98,polvo:2665.34,totem:2815.01,garra:2730.45,colmillo:2685.12,sangre:2545.56,escama:2645.98,hematites:8090.12,"empíreos":7645.67,dragonita:7645.67,sacos_reliquias:538.12,saco_equipamiento:4.01,miniatura:154}},{stacks:4e3,data:{oro_de_basura:4283407500,recetas_ascendentes:7555,infusion_mas1:2263678,llaves_encriptacion:99812,hueso:334960,veneno:337195,polvo:337825,totem:338230,garra:339190,colmillo:336540,sangre:339475,escama:339260,hematites:1013835,"empíreos":1012619,dragonita:1006125,sacos_reliquias:66795,saco_equipamiento:171,miniatura:19787}}];function i(){return a.filter(e=>e.id&&e.id>0)}function r(e){const t=a.find(t=>t.key===e);return t?t.nombre:e}"undefined"!=typeof window&&(window.FractalesLogic={FRACTALES_ITEMS:a,FRACTAL_STACKS:n,getItemsConMercado:i,keyToNombre:r});const d={garra:24350,totem:24299,sangre:24294,veneno:24282,hueso:24341,escama:24288,colmillo:24356,polvo:24276,infusion_mas1:49424,llaves_encriptacion:70438,"empíreos":46735,hematites:46731,dragonita:46733,sacos_reliquias:79792,saco_equipamiento:71510,miniatura:74268,encriptacion_fractal:75919,matriz_estabilizadora:73248};function s(t){const o=d[t];return o&&e[o]||""}function c(e){const o=d[e];return o&&t[o]||""}let l=null,m=null;async function p(e="tabla-resumen-oro",t={}){try{let t=0,d=0;n.forEach(e=>{void 0!==e.data.oro_de_basura&&(t+=e.data.oro_de_basura,d+=e.stacks)});const s=d>0?t/d:0;let c=[...i()];if(!c.find(e=>"infusion_mas1"===e.key)){const e=a.find(e=>"infusion_mas1"===e.key);e&&c.push(e)}const l=await o(c.map(e=>e.id)),m=c.map(e=>({...e,buy_price:l[e.id]?.buy_price||0,sell_price:l[e.id]?.sell_price||0})),p=n,u={};m.forEach(e=>{let t=0,o=0,a=0;if(p.forEach(n=>{void 0!==n.data[e.key]&&(t+=n.data[e.key],o+=n.stacks,a++)}),1===a){const t=p.find(t=>void 0!==t.data[e.key]);u[e.key]=t.data[e.key]/t.stacks}else u[e.key]=a>1?t/o:void 0});let v=0,y=0;m.forEach(e=>{const t=u[e.key];void 0!==t&&(v+=e.buy_price*t,y+=e.sell_price*t)});const f=s+.85*v,b=s+.85*y,h=[{nombre:"Oro crudo",valor:s}];m.forEach(e=>{const t=u[e.key];void 0!==t&&h.push({nombre:r(e.key),valor:e.sell_price*t*.85})});const _=`\n      <table class="table-modern" style="margin-top:12px;">\n        <thead>\n          <tr>\n            <th><div class="dato-item">Resumen</div></th>\n          <th><div class="dato-item">Valor total</div></th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td><div class="dato-item">Oro crudo + (Total compra × 0.85)</div></td>\n          <td><div class="dato-item-info">${window.formatGoldColored(Math.round(f))}</div></td>\n        </tr>\n        <tr>\n          <td><div class="dato-item">Oro crudo + (Total venta × 0.85)</div></td>\n          <td><div class="dato-item-info">${window.formatGoldColored(Math.round(b))}</div></td>\n        </tr>\n      </tbody>\n    </table>\n  `;if(e){const t=document.getElementById(e);t&&(t.innerHTML=_)}return{sumaCompra:f,sumaVenta:b,contribuciones:h}}catch(e){console.error("Error en renderTablaResumenOro:",e)}}"undefined"!=typeof window&&(window.FractalesGoldUI={setValoresFractales:function({compra75919:e,venta75919:t,compra73248:o,venta73248:a}){},ICON_ID_MAP:d,renderTablaPromedios:async function(e="tabla-promedios"){try{const t=n,o=[{key:"oro_de_basura",nombre:"Oro crudo"},{key:"garra",nombre:"Garra potente"},{key:"totem",nombre:"Tótem intrincado"},{key:"sangre",nombre:"Vial de sangre potente"},{key:"veneno",nombre:"Vesícula de veneno potente"},{key:"hueso",nombre:"Hueso grande"},{key:"escama",nombre:"Escama blindada"},{key:"colmillo",nombre:"Colmillo afilado"},{key:"polvo",nombre:"Montón de polvo incandescente"},{key:"infusion_mas1",nombre:"Infusión +1"},{key:"llaves_encriptacion",nombre:"Clave de encriptación fractal"},{key:"empíreos",nombre:"Fragmento empíreo"},{key:"recetas_ascendentes",nombre:"Recetas ascendentes"},{key:"hematites",nombre:"Montón de polvo de hematites"},{key:"dragonita",nombre:"Mineral de dragonita"},{key:"sacos_reliquias",nombre:"Puñado de reliquias fractales"},{key:"saco_equipamiento",nombre:"Saco de equipo excepcional"},{key:"miniatura",nombre:"Miniatura del profesor Miau"}],a={};o.forEach(({key:e})=>{let o=0,n=0,i=0;if(t.forEach(t=>{void 0!==t.data[e]&&(o+=t.data[e],n+=t.stacks,i++)}),1===i){const o=t.find(t=>void 0!==t.data[e]);a[e]=o.data[e]/o.stacks}else a[e]=i>1?o/n:void 0});const i=o.map(({key:e,nombre:t})=>({id:e,nombre:t,icon:s(e),rarity:c(e),promedio:a[e]})),r=document.getElementById(e);r.innerHTML="";const d=document.createElement("table");d.className="table-modern",d.innerHTML='\n      <thead>\n        <tr>\n          <th><div class="dato-item">Recompensa</div></th>\n          <th><div class="dato-item">Promedio por stack</div></th>\n        </tr>\n      </thead>\n      <tbody></tbody>\n    ',r.appendChild(d);const l=d.querySelector("tbody");i.forEach((e,t)=>{const o=document.createElement("tr");o.setAttribute("data-id",e.id);const a=e.icon?`<img src="${e.icon}" class="item-icon">`:"",n="function"==typeof getRarityClass?getRarityClass(e.rarity):"",i=void 0!==e.promedio?"oro_de_basura"===e.id?window.formatGoldColored(e.promedio):e.promedio.toFixed(2):"-";o.innerHTML=`\n        <td><div class="dato-item">${a}<span class="${n}">${e.nombre}</span></div></td>\n        <td><div class="dato-item-info">${i}</div></td>\n      `,l.appendChild(o)})}catch(e){console.error("Error en renderTablaPromedios:",e)}},renderTablaPrecios:async function(e="tabla-precios-fractales"){try{let d=[...i()];if(!d.find(e=>"infusion_mas1"===e.key)){const e=a.find(e=>"infusion_mas1"===e.key);e&&d.push(e)}const c=n,l={};d.forEach(e=>{let t=0,o=0,a=0;if(c.forEach(n=>{void 0!==n.data[e.key]&&(t+=n.data[e.key],o+=n.stacks,a++)}),1===a){const t=c.find(t=>void 0!==t.data[e.key]);l[e.key]=t.data[e.key]/t.stacks}else l[e.key]=a>1?t/o:void 0});const m=await o(d.map(e=>e.id)),p=d.map(e=>({...e,buy_price:m[e.id]?.buy_price||0,sell_price:m[e.id]?.sell_price||0})).map(e=>({id:e.id,key:e.key,nombre:r(e.key),buy_price:e.buy_price,sell_price:e.sell_price,promedio:l[e.key],icon:s(e.key),rarity:t[e.id]})),u=document.getElementById(e);u.innerHTML="";const v=document.createElement("table");v.className="table-modern",v.innerHTML='\n      <thead>\n        <tr>\n          <th><div class="dato-item">Material</div></th>\n          <th><div class="dato-item">Precio compra</div></th>\n          <th><div class="dato-item">Precio venta</div></th>\n          <th><div class="dato-item">Total compra (prom)</div></th>\n          <th><div class="dato-item">Total venta (prom)</div></th>\n        </tr>\n      </thead>\n      <tbody></tbody>\n    ',u.appendChild(v);const y=v.querySelector("tbody");p.forEach((e,t)=>{const o=document.createElement("tr");o.setAttribute("data-id",e.id);const a=void 0!==e.promedio?window.formatGoldColored(Math.round(e.buy_price*e.promedio)):"-",n=void 0!==e.promedio?window.formatGoldColored(Math.round(e.sell_price*e.promedio)):"-",i=e.icon?`<img src="${e.icon}" class="item-icon">`:"",r="function"==typeof getRarityClass?getRarityClass(e.rarity):"";o.innerHTML=`\n        <td><div class="dato-item">${i}<span class="${r}">${e.nombre}</span></div></td>\n        <td><div class="dato-item-info">${window.formatGoldColored(e.buy_price)}</div></td>\n        <td><div class="dato-item-info">${window.formatGoldColored(e.sell_price)}</div></td>\n        <td><div class="dato-item-info">${a}</div></td>\n        <td><div class="dato-item-info">${n}</div></td>\n      `,y.appendChild(o)})}catch(e){console.error("Error en renderTablaPrecios:",e)}},renderTablaResumenOro:p,renderTablaResumenOroIndividual:async function(e="tabla-resumen-oro-individual",t={}){try{const o=await p(void 0,t);if(!o)return;const a=250,n=o.sumaCompra/a,i=o.sumaVenta/a,r=`\n      <table class="table-modern" style="margin-top:12px;">\n        <thead>\n          <tr>\n            <th><div class="dato-item">Resumen</div></th>\n            <th><div class="dato-item">Valor total</div></th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td><div class="dato-item">Oro crudo + (Total compra × 0.85) ÷ 250</div></td>\n            <td><div class="dato-item-info">${window.formatGoldColored(Math.round(n))}</div></td>\n          </tr>\n          <tr>\n            <td><div class="dato-item">Oro crudo + (Total venta × 0.85) ÷ 250</div></td>\n            <td><div class="dato-item-info">${window.formatGoldColored(Math.round(i))}</div></td>\n          </tr>\n        </tbody>\n      </table>\n    `;return e&&(document.getElementById(e).innerHTML=r),{sumaCompra:n,sumaVenta:i}}catch(e){console.error("Error en renderTablaResumenOroIndividual:",e)}},renderTablaReferenciasProfit:function(e="tabla-referencias-profit",t={},o={}){const{compra75919:a=0,venta75919:n=0,compra73248:i=0,venta73248:r=0}=t,{sumaVenta:d=0}=o,c=250*(a+i),l=c>0?(d-c)/c*100:0,m=s("encriptacion_fractal"),p=s("matriz_estabilizadora"),u=m?`<img src="${m}" class="item-icon">`:"",v=p?`<img src="${p}" class="item-icon">`:"",y=`\n    <table class="table-modern" style="margin-top:0;">\n      <thead>\n        <tr>\n          <th><div class="dato-item">Resumen</div></th>\n          <th><div class="dato-item">Valor total</div></th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td><div class="dato-item">${u}Encriptación fractal (compra ×250)</div></td>\n          <td><div class="dato-item-info">${window.formatGoldColored(250*a)}</div></td>\n        </tr>\n        <tr>\n          <td><div class="dato-item">${u}Encriptación fractal (venta ×250)</div></td>\n          <td><div class="dato-item-info">${window.formatGoldColored(250*n)}</div></td>\n        </tr>\n        <tr>\n          <td><div class="dato-item">${v}Matriz estabilizadora (compra ×250)</div></td>\n          <td><div class="dato-item-info">${window.formatGoldColored(250*i)}</div></td>\n        </tr>\n        <tr>\n          <td><div class="dato-item">${v}Matriz estabilizadora (venta ×250)</div></td>\n          <td><div class="dato-item-info">${window.formatGoldColored(250*r)}</div></td>\n        </tr>\n        <tr>\n          <td><div class="dato-item">Suma Encriptación + Matriz (compra) - 15% de comisión</div></td>\n          <td><div class="dato-item-info">${window.formatGoldColored(250*(a+i)*.85)}</div></td>\n        </tr>\n        <tr>\n          <td><div class="dato-item">Suma Encriptación + Matriz (venta) - 15% de comisión</div></td>\n          <td><div class="dato-item-info">${window.formatGoldColored(250*(n+r)*.85)}</div></td>\n        </tr>\n        <tr>\n          <td><div class="dato-item"><strong>ROI abrir stack</strong></div></td>\n          <td><div class="dato-item-info" style="color:${l>=0?"green":"red"};">${l.toFixed(2)} %</div></td>\n        </tr>\n      </tbody>\n    </table>\n  `;document.getElementById(e).innerHTML=y},renderGraficoContribuciones:function(e=[],t="contribuciones-chart"){const o=document.getElementById(t)?.getContext("2d");if(!o)return;l&&l.destroy();const a=e.map(e=>e.nombre),n=e.map(e=>e.valor/1e4);l=new Chart(o,{type:"bar",data:{labels:a,datasets:[{label:"Oro",data:n,backgroundColor:"rgba(54, 162, 235, 0.6)"}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Oro"}}}}})},renderGraficoAbrirVsVender:function(e="abrir-vs-vender-chart",t={},o={}){const a=document.getElementById(e)?.getContext("2d");if(!a)return;m&&m.destroy();const{venta75919:n=0,compra75919:i=0,compra73248:r=0}=t,{sumaVenta:d=0}=o;m=new Chart(a,{type:"bar",data:{labels:["Vender stack de encriptación","Abrir con llaves","Abrir comprando matrices","Abrir comprando matrices y encriptaciones"],datasets:[{label:"Oro",data:[250*n*.85/1e4,d/1e4,(d-250*r)/1e4,(d-250*(r+i))/1e4],backgroundColor:["rgba(255,99,132,0.6)","rgba(75,192,192,0.6)","rgba(255,205,86,0.6)","rgba(153,102,255,0.6)"]}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Oro"}}}}})},renderExtras:function(e={},t=24.96){const{venta73248:o=0}=e,a=document.getElementById("matriz-precio"),n=document.getElementById("conversion-indirecta");if(a&&(a.innerHTML=window.formatGoldColored(o)),n){const e=Math.round(o*t);n.innerHTML=window.formatGoldColored(e)}}});
