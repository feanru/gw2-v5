const e={},t={};async function o(o=[]){if(o.length)try{const r=await fetch(`https://api.guildwars2.com/v2/items?ids=${o.join(",")}&lang=es`);(await r.json()).forEach(o=>{o&&o.id&&(e[o.id]=o.icon,t[o.id]=o.rarity)})}catch{}}async function r(e=[]){if(!e||0===e.length)return{};const t=`https://api.datawars2.ie/gw2/v1/items/csv?fields=id,buy_price,sell_price&ids=${e.join(",")}`;try{const e=await fetch(t).then(e=>e.text()),[o,...r]=e.trim().split("\n"),c=o.split(","),i=c.indexOf("id"),n=c.indexOf("buy_price"),a=c.indexOf("sell_price"),s={};return r.forEach(e=>{const t=e.split(","),o=parseInt(t[i],10);isNaN(o)||(s[o]={buy_price:parseInt(t[n],10)||0,sell_price:parseInt(t[a],10)||0})}),s}catch(e){return{}}}function c(e,t){if(!e||!t)return;const o=e.querySelector("div");if(!o||o.querySelector("img"))return;const r=document.createElement("img");r.src=t,r.className="item-icon",o.prepend(r)}"undefined"!=typeof window&&(window.FractalesUtils={fetchIconsFor:o,fetchItemPrices:r,iconCache:e,rarityCache:t});const i={t6:{sangre:24295,hueso:24358,garra:24351,colmillo:24357,escama:24289,totem:24300,veneno:24283},t5:{sangre:24294,hueso:24341,garra:24350,colmillo:24356,escama:24288,totem:24299,veneno:24282},polvo:24277,piedra:20796},n={cores:{glacial:24319,cristal:24329,destructor:24324,cargado:24304,corrupto:24339,onice:24309,fundido:24314},stones:{glacial:24320,cristal:24330,destructor:24325,cargado:24305,corrupto:24340,onice:24310,fundido:24315},polvo:24277,botella:19663,cristal:20799};document.addEventListener("DOMContentLoaded",()=>{!async function(){const t=Object.keys(i.t5),n=[...t.map(e=>i.t5[e]),...t.map(e=>i.t6[e]),i.polvo,i.piedra],a=await r(n);await o(n),t.forEach(t=>{const o=document.querySelector(`#matt5t6 tr[data-key="${t}"]`);if(!o)return;const r=o.querySelector(".sum-mats"),n=o.querySelector(".resultado"),s=o.querySelector(".profit"),l=a[i.t5[t]]?.buy_price||0,d=a[i.t6[t]]?.buy_price||0,u=a[i.t6[t]]?.sell_price||0,p=50*l+5*(a[i.polvo]?.buy_price||0)+5*(a[i.piedra]?.buy_price||0)+d,y=6.91*u*.85,f=y-p;r&&(r.innerHTML=window.formatGoldColored(p)),n&&(n.innerHTML=window.formatGoldColored(y)),s&&(s.innerHTML=window.formatGoldColored(f));const m=o.querySelectorAll("td");c(m[0],e[i.t5[t]]),c(m[1],e[i.t6[t]]),c(m[2],e[i.polvo]),c(m[3],e[i.piedra])})}(),async function(){const t=Object.keys(n.cores),i=[...t.map(e=>n.cores[e]),...t.map(e=>n.stones[e]),n.polvo,n.botella,n.cristal],a=await r(i);await o(i),t.forEach(t=>{const o=document.querySelector(`#tabla-lodestones tr[data-key="${t}"]`);if(!o)return;const r=o.querySelector(".sum-mats"),i=o.querySelector(".profit"),s=a[n.cores[t]]?.buy_price||0,l=a[n.stones[t]]?.sell_price||0,d=2*s+(a[n.polvo]?.buy_price||0)+(a[n.botella]?.buy_price||0)+(a[n.cristal]?.buy_price||0),u=.85*l-d;r&&(r.innerHTML=window.formatGoldColored(d)),i&&(i.innerHTML=window.formatGoldColored(u));const p=o.querySelectorAll("td");c(p[0],e[n.cores[t]]),c(p[1],e[n.polvo]),c(p[2],e[n.botella]),c(p[3],e[n.cristal]),c(p[4],e[n.stones[t]])})}()});
