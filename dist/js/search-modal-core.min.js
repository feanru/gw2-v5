import{requestItems as e}from"./utils/requestManager.min.js";import"./utils/cache.min.js";import"./utils/cachePolicies.min.js";import"./utils/cacheSync.min.js";function t(t={}){const{onSelect:n=function(e){},formatPrice:i=null,useSuggestions:s=!1}=t,o=document.getElementById("modal-search-input"),l=document.getElementById("modal-suggestions"),a=document.getElementById("modal-results"),r=document.getElementById("modal-skeleton"),c=document.getElementById("modal-error-message");let d=[];const m={},u={};function p(e){r&&r.classList.toggle("hidden",!e)}async function y(){const e=sessionStorage.getItem("itemList");if(e)d=JSON.parse(e);else{c&&(c.style.display="none");try{const[e,t]=await Promise.all([fetch("https://api.datawars2.ie/gw2/v1/items/json?fields=id,name_es"),fetch("https://api.datawars2.ie/gw2/v1/items/csv?fields=buy_price,sell_price,buy_quantity,sell_quantity,last_updated,1d_buy_sold,1d_sell_sold,2d_buy_sold,2d_sell_sold,7d_buy_sold,7d_sell_sold,1m_buy_sold,1m_sell_sold")]),[n,i]=await Promise.all([e.json(),t.text()]),s=i.trim().split("\n"),o=s[0].split(","),l=s.slice(1).map(e=>{const t=e.split(","),n={};return o.forEach((e,i)=>{n[e]="last_updated"===e?t[i]||"-":""!==t[i]?parseInt(t[i],10):null}),n}),a={};l.forEach(e=>{a[Number(e.id)]=e}),d=n.map(e=>({...e,...a[Number(e.id)]||{}})),sessionStorage.setItem("itemList",JSON.stringify(d))}catch(e){t="No se pudieron cargar los ítems.",c&&(c.textContent=t,c.style.display="block")}var t}}function f(e,t=!1){if(!a)return;if(a.innerHTML="",!e.length&&t)return void(a.innerHTML='<div class="error-message">No se encontraron ítems.</div>');const s=document.createDocumentFragment();e.forEach(e=>{const t=document.createElement("div");t.className="item-card",t.onclick=t=>n(e.id,t);const o="function"==typeof getRarityClass?getRarityClass(u[e.id]):"",l=i?i(e.buy_price):e.buy_price||0,a=i?i(e.sell_price):e.sell_price||0;t.innerHTML=`\n      <img src="${m[e.id]||""}" alt=""/>\n      <div class="item-name ${o}">${e.name_es}</div>\n      <div class="item-price" style="display:none;">Compra: ${l} | Venta: ${a}</div>\n    `,s.appendChild(t)}),a.appendChild(s)}function g(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}o&&o.addEventListener("input",function(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>e.apply(this,i),t)}}(async function(){const t=this.value.trim().toLowerCase();if(t.length<3)return s&&l&&(l.style.display="none"),a&&(a.innerHTML=""),void p(!1);p(!0);const i=g(t);let o=d.filter(e=>e.name_es&&g(e.name_es).includes(i));o=o.slice(0,30);const r=o.filter(e=>!m[e.id]).map(e=>e.id);r.length&&await async function(t){if(t.length)try{(await e(t)).forEach(e=>{e&&(m[e.id]=e.icon,u[e.id]=e.rarity)})}catch{}}(r),p(!1),function(e){if(!s)return void(l&&(l.innerHTML="",l.style.display="none"));if(!l)return;if(l.innerHTML="",!e.length)return void(l.style.display="none");const t=document.createDocumentFragment();e.forEach(e=>{const i=document.createElement("li");i.textContent=e.name_es,i.onclick=()=>n(e.id),t.appendChild(i)}),l.appendChild(t),l.style.display="block"}(o),f(o,!0)},250)),async function(){p(!0),await y(),f([]),p(!1)}()}"undefined"!=typeof window&&(window.initSearchModal=t),"undefined"!=typeof module&&module.exports&&(module.exports.initSearchModal=t);
