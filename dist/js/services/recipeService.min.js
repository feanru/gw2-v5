import{getCached as e,setCached as t}from"../utils/cache.min.js";import{fetchWithCache as r}from"../utils/requestCache.min.js";import"../utils/cachePolicies.min.js";import"../utils/cacheSync.min.js";async function i(r=[]){if(!Array.isArray(r)||0===r.length)return[];const i=new Map,n=[];if(r.forEach(t=>{const r=e(`bundle_${t}`);r?i.set(t,r):n.push(t)}),n.length>0){const e=n.map(e=>`ids[]=${e}`).join("&");try{const r=await fetch(`/backend/api/dataBundle.php?${e}`);if(r.ok){(await r.json()).forEach(e=>{t(`bundle_${e.id}`,e),i.set(e.id,e),window.dispatchEvent(new CustomEvent("bundleItemLoaded",{detail:e}))})}}catch(e){console.error("Error en getItemBundles:",e)}}return r.map(e=>i.get(e)||null)}async function n(e){const t=Array.isArray(e)?e:[e],r=await i(t);if(Array.isArray(e))return r.map(e=>e?.recipe?[e.recipe]:[]);const n=r[0]?.recipe;return n?[n]:[]}async function a(i){const n=`recipe_${i}`,a=e(n,!0);try{const e=await r(`https://api.guildwars2.com/v2/recipes/${i}`,{},n,a);if(!e.ok)return null;const s=await e.json();if(!s)return null;s.lastUpdated=(new Date).toISOString();const c=e.headers.get("ETag"),o=e.headers.get("Last-Modified");return t(n,s,void 0,{etag:c,lastModified:o}),s}catch(e){return console.error("Error en getRecipeDetails:",e),null}}async function s(e){if(Array.isArray(e)){return(await i(e)).map(e=>e?.item||null)}const t=await i([e]);return t[0]?.item||null}async function c(e){if(Array.isArray(e)){return(await i(e)).map(e=>{const t=e?.market||{};return{buys:{unit_price:t.buy_price||0},sells:{unit_price:t.sell_price||0}}})}const t=await i([e]),r=t[0]?.market||{};return{buys:{unit_price:r.buy_price||0},sells:{unit_price:r.sell_price||0}}}"undefined"!=typeof window&&(window.getRecipesForItem=n,window.getRecipeDetails=a,window.getItemDetails=s,window.getItemPrices=c,window.getItemBundles=i);export{i as getItemBundles,s as getItemDetails,c as getItemPrices,a as getRecipeDetails,n as getRecipesForItem};
