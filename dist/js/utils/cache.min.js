import{CACHE_TTLS as e}from"./cachePolicies.min.js";import{setupCacheSync as t,requestBundleSync as l,notifyDelete as n,notifySet as o}from"./cacheSync.min.js";const a=new Map;t(a),l();const i="undefined"!=typeof localStorage;function r(e){try{return JSON.parse(e)}catch{return null}}function c(e,t){if(i)try{localStorage.setItem(e,function({value:e,expiresAt:t,etag:l,lastModified:n}){return JSON.stringify({value:e,expiresAt:t,etag:l,lastModified:n})}(t))}catch{}}function u(t,l,n=void 0,i={}){if(void 0===n){const l=t.split("_")[0];n=e[l]}const r=null==n?null:Date.now()+n,{etag:u=null,lastModified:s=null}=i,f={value:l,expiresAt:r,updatedAt:(new Date).toISOString(),etag:u,lastModified:s};a.set(t,f),c(t,{value:l,expiresAt:r,etag:u,lastModified:s}),o(t,f)}function s(e,t=!1){let l=a.get(e);if(!l){const t=function(e){if(!i)return null;const t=localStorage.getItem(e);if(!t)return null;const l=r(t);return l||(localStorage.removeItem(e),null)}(e);if(t){const{value:n,expiresAt:o=null,etag:i=null,lastModified:r=null}=t;l={value:n,expiresAt:o,updatedAt:(new Date).toISOString(),etag:i,lastModified:r},a.set(e,l)}}return l?l.expiresAt&&Date.now()>l.expiresAt?(a.delete(e),i&&localStorage.removeItem(e),n(e),null):t?l:l.value:null}!function(){if(!i)return;const e=[];for(let t=0;t<localStorage.length;t++){const l=localStorage.key(t),n=r(localStorage.getItem(l));if(!n)continue;const{expiresAt:o}=n;o&&Date.now()>o&&e.push(l)}e.forEach(e=>{localStorage.removeItem(e),n(e)})}();var f={getCached:s,setCached:u};export{f as default,s as getCached,u as setCached};
