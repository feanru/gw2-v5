import{getCached as e,setCached as t}from"./cache.min.js";import"./cachePolicies.min.js";import"./cacheSync.min.js";const o=new Set,i=new Map;let n=null;function r(){n||(n=setTimeout(s,50)),o.size>=200&&(clearTimeout(n),s())}async function s(){if(0===o.size)return void(n=null);n=null;const e=Array.from(o).slice(0,200);e.forEach(e=>o.delete(e));try{const o=await fetch("https://api.guildwars2.com/v2/items?ids="+e.join(",")+"&lang=es"),n=await o.json(),r=new Map(n.map(e=>[e.id,e]));e.forEach(e=>{const o=i.get(e),n=r.get(e);n?(t(`item_${e}`,n),o.resolve(n)):o.resolve(null),i.delete(e)})}catch(t){e.forEach(e=>{const o=i.get(e);o&&o.reject(t),i.delete(e)})}o.size>0&&r()}function c(t=[]){const n=t.map(t=>{const n=e(`item_${t}`);if(n)return Promise.resolve(n);if(i.has(t))return i.get(t).promise;const s={};return s.promise=new Promise((e,t)=>{s.resolve=e,s.reject=t}),i.set(t,s),o.add(t),r(),s.promise});return Promise.all(n)}!function(){if("undefined"!=typeof localStorage)for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);o.startsWith("item_")&&e(o)}}();export{c as requestItems};
