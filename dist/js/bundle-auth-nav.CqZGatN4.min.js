import{f as t}from"./utils-bc8VNvJR.js";import"./services-Cd2sNgr4.js";let e=null;async function n(){return e=await async function(){try{const e=await t("backend/api/user.php");return e.ok?e.json():null}catch(t){return null}}(),o(),e}function o(){document.dispatchEvent(new CustomEvent("auth-updated",{detail:e}))}window.Auth={get currentUser(){return e},initAuth:n,loginWithGoogle:function(){window.location.href="backend/auth.php?provider=google"},loginWithDiscord:function(){window.location.href="backend/auth.php?provider=discord"},logout:function(){e=null,o(),navigator.serviceWorker?.controller?.postMessage({type:"invalidateAll"}),window.location.href="backend/logout.php"},requireAuth:function(){return!!e||(window.location.href="/login",!1)}};const a={init(){this.theme=localStorage.getItem("theme")||"dark",this.applyTheme()},toggleTheme(){this.theme="dark"===this.theme?"light":"dark",localStorage.setItem("theme",this.theme),this.applyTheme()},applyTheme(){document.body.classList.toggle("light-theme","light"===this.theme),document.body.classList.toggle("dark-theme","dark"===this.theme);const t=document.getElementById("bg-video"),e=document.getElementById("bg-overlay");t&&t.classList.toggle("dark","dark"===this.theme),e&&(e.style.background="dark"===this.theme?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.6)");document.querySelectorAll(".theme-toggle").forEach(t=>{t.textContent="dark"===this.theme?"üåô":"‚òÄÔ∏è"})}},i={menuItems:[{text:"Inicio",href:"/",target:"tab-detalles",class:""},{text:"Dones",href:"/dones",target:"tab-crafteo",class:""},{text:"Comparativa",href:"/compare-craft",target:"tab-comparativa",class:"",requiresLogin:!0},{text:"Fractales",href:"/fractales-gold",target:"tab-fractales",class:"",requiresLogin:!0},{text:"Legendarias",href:"/leg-craft",target:"tab-leg-craft",class:""},{text:"Forja M√≠stica",href:"/forja-mistica",target:"tab-forja-mistica",class:""}],rightMenuItems:[{text:"üåô",href:"#",target:"",class:"right-btn theme-toggle",id:"theme-toggle",onClick:t=>{t.preventDefault(),a.toggleTheme()}},{text:"Iniciar sesi√≥n",href:"#",target:"",class:"right-btn",id:"loginBtn",onClick:t=>{t.preventDefault(),window.location.href="/login"}},{text:"",href:"#",target:"",class:"right-btn requires-login",id:"userInfo",style:"padding: 0 10px;",onClick:t=>{t.preventDefault(),r()}}]};function c(){const t=document.getElementById("loginBtn"),n=document.getElementById("userInfo"),o=e,a=!!o;document.body.classList.toggle("logged-in",a),t&&t.classList.toggle("hidden",a),document.querySelectorAll("[data-requires-login]").forEach(t=>{t.classList.toggle("requires-login",!a)}),a&&o&&n&&(n.innerHTML=`\n            <img src="${o.avatar||"https://via.placeholder.com/24"}" alt="avatar" style="width:24px;height:24px;border-radius:50%;vertical-align:middle;margin-right:5px;">\n            ${o.name||"Usuario"}\n        `,n.onclick=t=>{t.preventDefault(),r()});const i=document.querySelector(".tab-button.active");if(i){const t=i.getAttribute("data-tab");t&&"function"==typeof window.switchTab&&window.switchTab(t)}}function r(){if(document.getElementById("account-modal"))return;const t=e;if(!t)return;const n=document.createElement("div");n.id="account-modal",n.className="modal-overlay",n.innerHTML=`\n        <div class="account-modal-content">\n            <img src="${t.avatar||"https://via.placeholder.com/64"}" class="account-avatar" alt="avatar">\n            <div class="account-name">${t.name||"Usuario"}</div>\n            <div class="account-email">${t.email||""}</div>\n            <a href="/cuenta" class="account-link">Mi Cuenta</a>\n            <button onclick="window.Auth && window.Auth.logout && window.Auth.logout()" class="logout-btn">Cerrar sesi√≥n</button>\n            <button class="close-account-btn">Cerrar</button>\n        </div>`,document.body.appendChild(n);const o=()=>n.remove();n.addEventListener("click",t=>{t.target===n&&o()}),n.querySelector(".close-account-btn").addEventListener("click",o)}function l(){const t=document.querySelector("header");if(t){const e=function(){const t=document.createElement("nav");t.className="topbar item-tabs-bar";const e=document.createElement("div");e.className="menu-center",i.menuItems.forEach(t=>{const n=document.createElement("a");n.href=t.href,n.className=`item-tab ${t.class}`.trim(),t.target&&n.setAttribute("data-target",t.target),t.requiresLogin&&n.classList.add("requires-login"),n.textContent=t.text,e.appendChild(n)});const n=document.createElement("div");return n.className="menu-right",i.rightMenuItems.forEach(t=>{const e=document.createElement("a");e.href=t.href,e.className=`item-tab ${t.class}`.trim(),t.target&&e.setAttribute("data-target",t.target),t.id&&(e.id=t.id),e.textContent=t.text,t.onClick&&e.addEventListener("click",t.onClick),n.appendChild(e)}),t.appendChild(e),t.appendChild(n),t}();t.insertBefore(e,t.firstChild),a.init(),c(),e.querySelectorAll("a.item-tab").forEach(t=>{"userInfo"!==t.id&&t.addEventListener("click",()=>{const t=document.getElementById("account-modal");t&&t.remove()})})}}function s(){l(),n()}document.addEventListener("auth-updated",c),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s(),window.updateAuthMenu=c,window.showAuthOptions=function(){let t=document.getElementById("auth-modal");t||(t=document.createElement("div"),t.id="auth-modal",t.className="modal-overlay",t.innerHTML='\n            <div class="auth-modal-content">\n                <h3 style=\'margin-bottom:18px;color:#fff;\'>Iniciar sesi√≥n</h3>\n                <button id="google-login-btn" class="auth-btn google-btn">\n                    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/google/google-original.svg" alt="google"> Google\n                </button>\n                <button id="discord-login-btn" class="auth-btn discord-btn">\n                    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/discordjs/discordjs-original.svg" alt="discord"> Discord\n                </button>\n                <a href="/login" class="auth-classic-link">¬øPrefieres iniciar sesi√≥n cl√°sico?</a>\n                <button onclick="document.getElementById(\'auth-modal\').remove()" class="auth-cancel-btn">Cancelar</button>\n            </div>',document.body.appendChild(t),document.getElementById("google-login-btn").onclick=()=>{window.Auth&&window.Auth.loginWithGoogle&&window.Auth.loginWithGoogle()},document.getElementById("discord-login-btn").onclick=()=>{window.Auth&&window.Auth.loginWithDiscord&&window.Auth.loginWithDiscord()})},window.showAccountModal=r;
