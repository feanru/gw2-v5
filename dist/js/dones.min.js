import{showSkeleton as n,hideSkeleton as e}from"./ui-helpers.min.js";const{fetchItemData:t,fetchPriceData:o,isGiftName:a,shouldSkipMarketCheck:d}=window.DonesCore||{};var i=[{id:19673,name:"Don de la Magia",mainIngredients:[{id:19675,name:"Trébol místico",type:"account_bound",count:77,components:[{id:19976,name:"Moneda mística",count:250},{id:19721,name:"Pegote de ectoplasma",count:250},{id:19925,name:"Esquirla de obsidiana",count:250},{id:20796,name:"Piedra filosofal",count:1500}]},{id:19721,name:"Pegote de ectoplasma",count:250}],manualIngredients:[{id:24295,name:"Vial de sangre poderosa",count:250},{id:24283,name:"Vesícula de veneno poderoso",count:250},{id:24300,name:"Tótem elaborado",count:250},{id:24277,name:"Montón de polvo cristalino",count:250}]},{id:19672,name:"Don del Poder",manualIngredients:[{id:24357,name:"Colmillo feroz",count:250},{id:24289,name:"Escama blindada",count:250},{id:24351,name:"Garra despiadada",count:250},{id:24358,name:"Hueso antiguo",count:250}]},{id:19626,name:"Don de la Suerte",mainIngredients:[{id:19721,name:"Pegote de ectoplasma",count:250},{id:19675,name:"Trébol místico",type:"account_bound",count:77,components:[{id:19976,name:"Moneda mística",count:250},{id:19721,name:"Pegote de ectoplasma",count:250},{id:19925,name:"Esquirla de obsidiana",count:250},{id:20796,name:"Piedra filosofal",count:1500}]},{id:19673,name:"Don de la Magia",type:"crafting_material",count:1,components:[{id:24295,name:"Vial de sangre poderosa",count:250},{id:24283,name:"Vesícula de veneno poderoso",count:250},{id:24300,name:"Tótem elaborado",count:250},{id:24277,name:"Montón de polvo cristalino",count:250}]},{id:19672,name:"Don del Poder",type:"crafting_material",count:1,components:[{id:24351,name:"Colmillo feroz",count:250},{id:24289,name:"Escama blindada",count:250},{id:24357,name:"Garra despiadada",count:250},{id:24358,name:"Hueso antiguo",count:250}]}]}];document.getElementById("dones-content");const s=document.getElementById("dones-skeleton"),c=document.getElementById("error-message");async function r(n,e){const o=e||document.getElementById("dones-content");o.innerHTML="",c.style.display="none";try{let e=n.name,a=null;if(n.id<9e4){const o=await t(n.id);e=o.name,a=o.icon}else{const e=n.manualIngredients[0];a=(await t(e.id)).icon}let d="";const i=n.name?n.name.toLowerCase():"",s=i.includes("suerte")||i.includes("magia")||i.includes("poder");if(s){if(n.mainIngredients&&n.mainIngredients.length>0){d+="<table class='table-modern-dones tabla-tarjetas'>\n          <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>";let e=0,t=0;for(const o of n.mainIngredients){const n=await h(o,0);d+=n.html,e+=n.totalBuy||0,t+=n.totalSell||0}d+="</tbody></table>",(e>0||t>0)&&(d+=`<div class='table-modern-totales' style='margin-bottom:50px;'>\n            <div class='precio-totales-dones'>\n              <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(e)}</div>\n              <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(t)}</div>\n            </div>\n          </div>`)}return void(o.innerHTML+=d)}if(s||(d+=`<h2 style='margin-top:18px;'><img src='${a}' style='height:32px;vertical-align:middle;'> ${e}</h2>`),n.mainIngredients&&n.mainIngredients.length>0){d+="<table class='table-modern-dones tabla-tarjetas'>\n        <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>";let e=0,t=0;for(const o of n.mainIngredients){const n=await h(o,0);d+=n.html,e+=n.totalBuy||0,t+=n.totalSell||0}d+="</tbody></table>",(e>0||t>0)&&(d+=`<div class='table-modern-totales' style='margin-bottom:50px;'>\n          <div class='precio-totales-dones'>\n            <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(e)}</div>\n            <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(t)}</div>\n          </div>\n        </div>`)}if(s)return;o.innerHTML+=d}catch(n){c.innerText=n.message,c.style.display="block"}}async function l(){const t=document.getElementById("dones-1ra-gen-content"),o=document.getElementById("dones-1ra-gen-skeleton");if(t&&o){n(o),t.innerHTML="";try{const a=await async function(){const{LEGENDARY_ITEMS:n}=window.LegendaryData||{},e=[],t=new Set;for(const o of Object.values(n)){if(!o.components)continue;const n=o.components.find(n=>{if(!n.name)return!1;const e=n.name.toLowerCase();return e.startsWith("don de")&&!e.includes("la suerte")&&!e.includes("del dominio")});n&&!t.has(n.id)&&(t.add(n.id),e.push({id:n.id,name:n.name,mainIngredients:n.components||[],manualIngredients:[]}))}return e.sort((n,e)=>n.name.localeCompare(e.name,"es")),e}(),d=document.createElement("div");d.className="don1gen-nav-btns",d.style="margin-bottom: 10%; display: flex; flex-wrap: wrap; gap: 10px;";const i=document.createElement("div");i.id="don1gen-result",a.forEach(t=>{const a=document.createElement("button");a.className="dones-btn",a.textContent=t.name,a.addEventListener("click",async()=>{d.querySelectorAll("button").forEach(n=>n.classList.remove("active")),a.classList.add("active"),i.innerHTML="",n(o),await r(t,i),e(o)}),d.appendChild(a)}),t.appendChild(d),t.appendChild(i)}catch(n){console.error("Error al renderizar dones de 1ra Gen:",n),t.innerHTML='<div class="error-message">Error al cargar los dones.</div>'}finally{e(o)}}}async function m(){const t=document.getElementById("tributo-draconico-content"),o=document.getElementById("tributo-draconico-skeleton");if(t&&o){n(o),t.innerHTML="";try{const n=await async function(){const{LEGENDARY_ITEMS_3GEN:n}=window.LegendaryData||{};for(const e of Object.values(n)){const n=e.components?.find(n=>(n.name?.toLowerCase()||"").includes("tributo dracónico"));if(n)return n}throw new Error("No se encontró el Tributo Dracónico en legendaryItems3gen")}();let e=`<h2>${n.name}</h2>`;e+="<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>";let o=0,a=0;for(const t of n.components){const n=await h(t,0);e+=n.html,o+=n.totalBuy||0,a+=n.totalSell||0}e+="</tbody></table>",e+=`<div class='table-modern-totales' style='margin-bottom:50px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(o)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(a)}</div>\n      </div>\n    </div>`,t.innerHTML=e}catch(n){console.error("Error al renderizar Tributo Dracónico:",n),t.innerHTML='<div class="error-message">Error al cargar el Tributo Dracónico.</div>'}finally{e(o)}}}window.showSkeleton=n,window.hideSkeleton=e;const u={special:!1,tributo:!1,draco:!1,gen1:!1};window.DonesPages={loadSpecialDons:async function(){u.special||(u.special=!0,await async function(){const t=document.getElementById("dones-content"),o=s;n(o),t.innerHTML="";const a=i.filter(n=>n.name&&n.name.toLowerCase().includes("suerte"));for(const n of a){const e=document.createElement("div");t.appendChild(e),await r(n,e)}e(o)}())},loadTributo:async function(){u.tributo||(u.tributo=!0,await async function(){const t=document.getElementById("tributo-content"),o=document.getElementById("tributo-skeleton");if(!t||!o)return;n(o),t.innerHTML="";try{const n=function(){const n={id:"TRIBUTO_MISTICO_ROOT",name:p.name,count:1,components:[]};return p.mainIngredients.forEach(e=>{n.components.push({...e})}),p.dons.forEach(e=>{const t=e.name.toLowerCase().includes("magia condensada")||e.name.toLowerCase().includes("poder condensado")?2:1,o={id:e.name.replace(/\s+/g,"_").toUpperCase(),name:e.name,count:t,components:[]};e.subdons.forEach(n=>{const e={id:n.name.replace(/\s+/g,"_").toUpperCase(),name:n.name,count:1,components:[]};n.ingredients.forEach(n=>{e.components.push({...n})}),o.components.push(e)}),n.components.push(o)}),n}();let e=`<h2>${n.name}</h2>`;e+="<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>";let o=0,a=0;for(const t of n.components){const n=await h(t,0);e+=n.html,o+=n.totalBuy||0,a+=n.totalSell||0}e+="</tbody></table>",e+=`<div class='table-modern-totales' style='margin-bottom:18px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(o)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(a)}</div>\n      </div>\n    </div>`,t.innerHTML=e}catch(n){console.error("Error al renderizar Tributo Místico:",n),t.innerHTML='<div class="error-message">Error al cargar el Tributo Místico.</div>'}finally{e(o)}}())},loadDraconicTribute:async function(){u.draco||(u.draco=!0,await m())},loadDones1Gen:async function(){u.gen1||(u.gen1=!0,await l())}};const p={name:"Tributo Místico",mainIngredients:[{id:19675,name:"Trébol místico",type:"account_bound",count:77,components:[{id:19976,name:"Moneda mística",count:250},{id:19721,name:"Pegote de ectoplasma",count:250},{id:19925,name:"Esquirla de obsidiana",count:250},{id:20796,name:"Piedra filosofal",count:1500}]},{id:19976,name:"Moneda mística",count:250}],dons:[{name:"Don de magia condensada",subdons:[{name:"Don de sangre",ingredients:[{id:24295,name:"Vial de sangre poderosa",count:100},{id:24294,name:"Vial de sangre potente",count:250},{id:24293,name:"Vial de sangre espesa",count:50},{id:24292,name:"Vial de sangre",count:50}]},{name:"Don de veneno",ingredients:[{id:24283,name:"Vesícula de veneno poderoso",count:100},{id:24282,name:"Vesícula de veneno potente",count:250},{id:24281,name:"Vesícula de veneno llena",count:50},{id:24280,name:"Vesícula de veneno",count:50}]},{name:"Don de tótems",ingredients:[{id:24300,name:"Tótem elaborado",count:100},{id:24299,name:"Tótem intrincado",count:250},{id:24298,name:"Tótem grabado",count:50},{id:24297,name:"Tótem",count:50}]},{name:"Don de polvo",ingredients:[{id:24277,name:"Montón de polvo cristalino",count:100},{id:24276,name:"Montón de polvo incandescente",count:250},{id:24275,name:"Montón de polvo luminoso",count:50},{id:24274,name:"Montón de polvo radiante",count:50}]}]},{name:"Don de poder condensado",subdons:[{name:"Don de garras",ingredients:[{id:24351,name:"Garra despiadada",count:100},{id:24350,name:"Garra grande",count:250},{id:24349,name:"Garra afilada",count:50},{id:24348,name:"Garra",count:50}]},{name:"Don de escamas",ingredients:[{id:24289,name:"Escama blindada",count:100},{id:24288,name:"Escama grande",count:250},{id:24287,name:"Escama suave",count:50},{id:24286,name:"Escama",count:50}]},{name:"Don de huesos",ingredients:[{id:24358,name:"Hueso antiguo",count:100},{id:24341,name:"Hueso grande",count:250},{id:24345,name:"Hueso pesado",count:50},{id:24344,name:"Hueso",count:50}]},{name:"Don de colmillos",ingredients:[{id:24357,name:"Colmillo feroz",count:100},{id:24356,name:"Colmillo grande",count:250},{id:24355,name:"Colmillo afilado",count:50},{id:24354,name:"Colmillo",count:50}]}]}]};async function h(n,e=0){let i=0,s=0,c="";if(n.components&&n.components.length>0)for(const t of n.components){const n=await h(t,e+1);c+=n.html,i+=n.totalBuy||0,s+=n.totalSell||0}let r=null,l=null;const m=n.name?.toLowerCase()||"";let u=m.startsWith("don de ")||m.startsWith("don del ")||m.startsWith("don de la ");if("number"==typeof n.id&&n.id<1e6)try{r=await t(n.id)}catch(n){}const p="function"==typeof getRarityClass?getRarityClass(r?.rarity):"",g=r&&r.name?r.name:n.name;u||(u=a(g));const b=g.toLowerCase(),f=b.includes("estatua de")||"caja de diversión"===b||"vial de llama líquida"===b||"vial de azogue"===b,y=n.components&&n.components.length>0,v=19675===n.id||u&&y,C=u&&!y||d(n.id)||f;if(!v&&!C)try{l=await o(n.id)}catch(n){}const T=r&&r.icon?r.icon:"",E=n.count;let w=null,M=null,I=0,D=0;v?(i>0&&(w=Math.round(i/E)),s>0&&(M=Math.round(s/E)),I=i,D=s):(w=!C&&l?.buys?l.buys.unit_price:null,M=!C&&l?.sells?l.sells.unit_price:null,I=w?w*E:0,D=M?M*E:0);return{html:`<tr>\n    <td style='${e>0?`padding-left:${32*e}px;`:""}'>${T?`<img src='${T}' style='height:28px;'>`:"-"}</td>\n    <td><span class="${p}">${v?`${g} (componentes)`:g}</span></td>\n    <td>${E}</td>\n    <td>${w?formatGoldColored(w):C?"sin precio":"-"}</td>\n    <td>${M?formatGoldColored(M):C?"sin precio":"-"}</td>\n    <td>${I>0?formatGoldColored(I):C?"sin precio":"-"}</td>\n    <td>${D>0?formatGoldColored(D):C?"sin precio":"-"}</td>\n  </tr>`+c,totalBuy:v?I:I+i,totalSell:v?D:D+s}}
