void 0===window.StorageUtils&&console.error("Error: storageUtils.js no está cargado");const e='\n    <ul class="skeleton-items">\n        <li class="skeleton skeleton-item"></li>\n        <li class="skeleton skeleton-item"></li>\n        <li class="skeleton skeleton-item"></li>\n    </ul>';async function t(){const e=await(window.StorageUtils?.getFavoritos())??[],t=await(window.StorageUtils?.getComparativas())??[],n=document.getElementById("favoritosCount");n&&(n.textContent=e.length);const o=document.getElementById("comparacionesCount");o&&(o.textContent=t.length)}async function n(){const e=document.getElementById("favoritos-items-container");if(!e)return void console.error("No se encontró el contenedor de favoritos");const n=await(window.StorageUtils?.getFavoritos())??[];if(!n.length)return void(e.innerHTML='\n            <div class="no-items">\n                <span class="empty-icon" aria-hidden="true">📦</span>\n                <p>No hay ítems guardados aún.</p>\n                <p>Guarda ítems desde la página de detalles para verlos aquí.</p>\n            </div>');const o=document.createElement("ul");o.className="favoritos-list",n.forEach((n,a)=>{const i=document.createElement("li");i.className="favorito-item",i.dataset.id=n.id;const s=document.createElement("img");s.className="favorito-icon",s.src="img/sphere_5528251.svg",s.alt="icono",s.width=24,s.height=24;const r=document.createElement("a");r.href=`/item?id=${n.id}`,r.className="favorito-link",n.nombre?r.textContent=n.nombre:r.innerHTML='<div class="skeleton skeleton-block"></div>',fetch(`https://api.guildwars2.com/v2/items/${n.id}?lang=es`).then(e=>e.ok?e.json():null).then(e=>{e&&(e.icon&&(s.src=e.icon),e.name&&(r.textContent=e.name))}).catch(e=>console.error("Error fetching item detalles:",e));const c=document.createElement("span");c.className="favorito-id",c.textContent=`#${n.id}`;const l=document.createElement("button");l.className="delete-favorito",l.title="Eliminar de favoritos",l.innerHTML="&times;",l.onclick=async o=>{o.preventDefault(),o.stopPropagation(),confirm(`¿Eliminar "${n.nombre||"este ítem"}" de favoritos?`)&&(window.StorageUtils&&window.StorageUtils.removeFavorito&&await window.StorageUtils.removeFavorito(n.id),i.remove(),0===document.querySelectorAll(".favorito-item").length&&(e.innerHTML='\n                        <div class="no-items">\n                            <span class="empty-icon" aria-hidden="true">📦</span>\n                            <p>No hay ítems guardados.</p>\n                        </div>'),window.StorageUtils?.showToast("Ítem eliminado de favoritos"),t())};const d=document.createElement("div");d.className="favorito-content",d.appendChild(s),d.appendChild(r),d.appendChild(c),i.appendChild(d),i.appendChild(l),o.appendChild(i)}),e.innerHTML="",e.appendChild(o);const a=document.createElement("div");a.className="favoritos-counter",a.textContent=`${n.length} ${1===n.length?"ítem":"ítems"} guardados`,e.prepend(a),t()}async function o(){const e=document.getElementById("lista-comparaciones");if(!e)return void console.error("No se encontró el contenedor de comparativas");const n=await(window.StorageUtils?.getComparativas())??[];if(!n.length)return void(e.innerHTML='\n            <div class="no-items">\n                <span class="empty-icon" aria-hidden="true">📦</span>\n                <p>No hay comparativas guardadas.</p>\n                <p>Guarda una comparativa desde la sección de comparativa para verla aquí.</p>\n            </div>');const o=document.createElement("ul");o.className="favoritos-list",n.forEach((n,a)=>{const i=document.createElement("li");i.className="favorito-item comparativa-item";const s=document.createElement("span");s.className="favorito-icon",s.innerHTML="📊";const r=Array.isArray(n.nombres)&&n.nombres.length?n.nombres.join(" vs "):`Comparativa ${a+1}`,c=document.createElement("a");c.href=`/compare-craft?ids=${n.ids.join(",")}`,c.className="favorito-link",c.textContent=r;const l=document.createElement("span");l.className="favorito-id";const d=n.ids.length;l.textContent=`(${d} ${1===d?"ítem":"ítems"})`;const m=document.createElement("button");m.className="delete-favorito",m.title="Eliminar comparativa",m.innerHTML="&times;",m.onclick=async o=>{o.preventDefault(),o.stopPropagation(),confirm("¿Eliminar esta comparativa?")&&(window.StorageUtils&&window.StorageUtils.removeComparativa&&await window.StorageUtils.removeComparativa(n.id),i.remove(),0===document.querySelectorAll(".comparativa-item").length&&(e.innerHTML="<p>No hay comparativas guardadas.</p>"),window.StorageUtils?.showToast("Comparativa eliminada"),t())};const p=document.createElement("div");p.className="favorito-content",p.appendChild(s),p.appendChild(c),p.appendChild(l),i.appendChild(p),i.appendChild(m),o.appendChild(i)}),e.innerHTML="",e.appendChild(o)}document.addEventListener("DOMContentLoaded",async function(){!function(){const e=document.getElementById("account-skeleton"),t=document.querySelector("main");e&&(e.style.display="block"),t&&(t.style.display="none")}();const a=await fetch("backend/api/user.php");if(!a.ok)return void(window.location.href="/login");const i=await a.json(),s=document.querySelector(".videos-board-topic");s&&(s.textContent=`Hola ${i.name||"Usuario"}`);const r=document.querySelector(".welcome-illustration img");r&&i.avatar&&(r.src=i.avatar,r.alt=`Avatar de ${i.name||"usuario"}`);const c=document.getElementById("refreshFavoritos");c&&c.addEventListener("click",function(){const t=document.getElementById("favoritos-items-container");t&&(t.innerHTML=e,setTimeout(n,300))});const l=document.getElementById("refreshComparativas");l&&l.addEventListener("click",function(){const t=document.getElementById("lista-comparaciones");t&&(t.innerHTML=e,setTimeout(o,300))}),await Promise.all([n(),o()]),await t(),function(){const e=document.getElementById("account-skeleton"),t=document.querySelector("main");e&&(e.style.display="none"),t&&(t.style.display="")}()});
