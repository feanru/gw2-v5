{"version":3,"file":"bundle-dones.V42DiObO.min.js","sources":["../../src/js/dones.js","../../src/js/bundle-dones.js"],"sourcesContent":["import { showSkeleton, hideSkeleton } from './ui-helpers.js';\nimport { restoreCraftIngredientPrototypes } from './items-core.js';\nconst { fetchItemData, fetchPriceData } = window.DonesCore || {};\n// js/dones.js\n\n// Sección de \"Dones Especiales\" (ejemplo: Don de la Suerte)\n// Puedes agregar más dones en el array DONES si lo deseas\n\nvar DONES = [\n  {\n    id: 19673, // ID real para Don de la Magia\n    name: \"Don de la Magia\",\n    mainIngredients: [\n      { id: 19675, name: \"Trébol místico\", type: \"account_bound\", count: 77, components: [\n  { id: 19976, name: \"Moneda mística\", count: 250 },\n  { id: 19721, name: \"Pegote de ectoplasma\", count: 250 },\n  { id: 19925, name: \"Esquirla de obsidiana\", count: 250 },\n  { id: 20796, name: \"Piedra filosofal\", count: 1500 }\n]},\n      { id: 19721, name: \"Pegote de ectoplasma\", count: 250 }\n    ],\n    manualIngredients: [\n      { id: 24295, name: \"Vial de sangre poderosa\", count: 250 },\n      { id: 24283, name: \"Vesícula de veneno poderoso\", count: 250 },\n      { id: 24300, name: \"Tótem elaborado\", count: 250 },\n      { id: 24277, name: \"Montón de polvo cristalino\", count: 250 },\n    ]\n  },\n  {\n    id: 19672, // ID real para Don del Poder\n    name: \"Don del Poder\",\n    manualIngredients: [\n      { id: 24357, name: \"Colmillo feroz\", count: 250 },\n      { id: 24289, name: \"Escama blindada\", count: 250 },\n      { id: 24351, name: \"Garra despiadada\", count: 250 },\n      { id: 24358, name: \"Hueso antiguo\", count: 250 },\n    ]\n  },\n  {\n    id: 19626,\n    name: \"Don de la Suerte\",\n    mainIngredients: [\n      { id: 19721, name: \"Pegote de ectoplasma\", count: 250 },\n      {\n        id: 19675,\n        name: \"Trébol místico\",\n        type: \"account_bound\",\n        count: 77,\n        components: [\n          { id: 19976, name: \"Moneda mística\", count: 250 },\n          { id: 19721, name: \"Pegote de ectoplasma\", count: 250 },\n          { id: 19925, name: \"Esquirla de obsidiana\", count: 250 },\n          { id: 20796, name: \"Piedra filosofal\", count: 1500 }\n        ]\n      },\n      {\n        id: 19673,\n        name: \"Don de la Magia\",\n        type: \"crafting_material\",\n        count: 1,\n        components: [\n          { id: 24295, name: \"Vial de sangre poderosa\", count: 250 },\n          { id: 24283, name: \"Vesícula de veneno poderoso\", count: 250 },\n          { id: 24300, name: \"Tótem elaborado\", count: 250 },\n          { id: 24277, name: \"Montón de polvo cristalino\", count: 250 }\n        ]\n      },\n      {\n        id: 19672,\n        name: \"Don del Poder\",\n        type: \"crafting_material\",\n        count: 1,\n        components: [\n          { id: 24351, name: \"Colmillo feroz\", count: 250 },\n          { id: 24289, name: \"Escama blindada\", count: 250 },\n          { id: 24357, name: \"Garra despiadada\", count: 250 },\n          { id: 24358, name: \"Hueso antiguo\", count: 250 }\n        ]\n      }\n    ]\n  }\n];\n\nconst API_ITEM = \"https://api.guildwars2.com/v2/items/\";\nconst API_PRICES = \"https://api.guildwars2.com/v2/commerce/prices/\";\n\nconst donesContent = document.getElementById('dones-content');\nconst donesSkeleton = document.getElementById('dones-skeleton');\nconst errorMsg = document.getElementById('error-message');\n\nwindow.showSkeleton = showSkeleton;\nwindow.hideSkeleton = hideSkeleton;\n\n\n// --- Fin de formatGold ---\n\n// IDs de ítems no comerciables o con precios especiales que deben saltarse\n// Items con precio fijo manual\nconst FIXED_PRICE_ITEMS = {\n  19676: 10000 // Piedra rúnica helada: 1 oro (10000 cobre)\n};\n\nconst EXCLUDED_ITEM_IDS = [\n  19675, // Trébol místico (account bound)\n  19925, // Esquirla de obsidiana (precio especial)\n  20796, // Piedra filosofal (precio especial)\n  20799, // Cristal místico (no comerciable)\n  19665, // Don del noble (account bound)\n  19674, // Don del dominio (account bound)\n  19626, // Don de la suerte (crafting, sin precio directo)\n  19672, // Don del poder\n  19673, // Don de la magia\n  19645, 19650, 19655, 19639, 19635, 19621 // Diversos \"Don de ...\" (account bound)\n];\nlet donesWorkerInstance = null;\nlet costsWorkerInstance = null;\n\nfunction runDonesWorker(rootIngredients) {\n  if (!donesWorkerInstance) {\n    donesWorkerInstance = new Worker(new URL('./workers/donesWorker.js', import.meta.url), { type: 'module' });\n  }\n  return new Promise((resolve, reject) => {\n    const handleMessage = (e) => {\n      donesWorkerInstance.removeEventListener('message', handleMessage);\n      donesWorkerInstance.removeEventListener('error', handleError);\n      resolve(e.data);\n    };\n    const handleError = (err) => {\n      donesWorkerInstance.removeEventListener('message', handleMessage);\n      donesWorkerInstance.removeEventListener('error', handleError);\n      // Show a clear message for worker failures\n      errorMsg.innerText = `Error del Worker: ${err.message || 'Fallo inesperado.'}`;\n      errorMsg.style.display = 'block';\n      // Reset the worker so future calls create a fresh instance\n      try {\n        donesWorkerInstance.terminate();\n      } catch {}\n      donesWorkerInstance = null;\n      reject(err);\n    };\n    donesWorkerInstance.addEventListener('message', handleMessage);\n    donesWorkerInstance.addEventListener('error', handleError);\n    donesWorkerInstance.postMessage({ rootIngredients });\n  });\n}\n\nfunction runCostsWorker(ingredientTree, globalQty) {\n  if (!costsWorkerInstance) {\n    const workerUrl = (typeof window !== 'undefined' && window.COSTS_WORKER_HASH)\n      ? `/dist/${window.__APP_VERSION__}/costsWorker.${window.COSTS_WORKER_HASH}.js?v=${window.__APP_VERSION__}`\n      : new URL('./workers/costsWorker.js', import.meta.url);\n    costsWorkerInstance = new Worker(workerUrl, { type: 'module' });\n  }\n  return new Promise((resolve, reject) => {\n    const handleMessage = (e) => {\n      costsWorkerInstance.removeEventListener('message', handleMessage);\n      costsWorkerInstance.removeEventListener('error', handleError);\n      resolve(e.data);\n    };\n    const handleError = (err) => {\n      costsWorkerInstance.removeEventListener('message', handleMessage);\n      costsWorkerInstance.removeEventListener('error', handleError);\n      // Provide feedback and reset the worker on errors\n      errorMsg.innerText = `Error del Worker: ${err.message || 'Fallo inesperado.'}`;\n      errorMsg.style.display = 'block';\n      try {\n        costsWorkerInstance.terminate();\n      } catch {}\n      costsWorkerInstance = null;\n      reject(err);\n    };\n    costsWorkerInstance.addEventListener('message', handleMessage);\n    costsWorkerInstance.addEventListener('error', handleError);\n    costsWorkerInstance.postMessage({ ingredientTree, globalQty });\n  });\n}\n\nasync function buildWorkerTree(ings) {\n  const { ingredientTree } = await runDonesWorker(ings);\n  const { updatedTree, totals } = await runCostsWorker(ingredientTree, 1);\n  restoreCraftIngredientPrototypes(updatedTree, null);\n  return { tree: updatedTree, totals };\n}\n\nfunction renderNodeHtml(node, level = 0) {\n  const indent = level > 0 ? `padding-left:${level * 32}px;` : '';\n  const priceBuy = node.buy_price ? formatGoldColored(node.buy_price) : '-';\n  const priceSell = node.sell_price ? formatGoldColored(node.sell_price) : '-';\n  const totalBuy = node.total_buy ? formatGoldColored(node.total_buy) : '-';\n  const totalSell = node.total_sell ? formatGoldColored(node.total_sell) : '-';\n  let rowHtml = `<tr>\n    <td style='${indent}'>${node.icon ? `<img src='${node.icon}' style='height:28px;'>` : '-'}</td>\n    <td>${node.name}</td>\n    <td>${Math.round(node.count)}</td>\n    <td>${priceBuy}</td>\n    <td>${priceSell}</td>\n    <td>${totalBuy}</td>\n    <td>${totalSell}</td>\n  </tr>`;\n  if (Array.isArray(node.children)) {\n    for (const child of node.children) {\n      rowHtml += renderNodeHtml(child, level + 1);\n    }\n  }\n  return rowHtml;\n}\n\n\nasync function renderDon(don, container) {\n  // Si no se pasa un contenedor, se usa el global por defecto (comportamiento antiguo)\n  const targetContainer = container || document.getElementById('dones-content');\n  targetContainer.innerHTML = ''; // Limpiamos el contenedor específico para este don\n  errorMsg.style.display = 'none';\n  // No limpiar donesContent aquí, para permitir varios dones en la página (limpiaremos solo una vez afuera)\n  try {\n    // Si el id es ficticio (mayor a 90000) NO pedir a la API el don principal\n    let donName = don.name;\n    let donIcon = null;\n    if (don.id < 90000) {\n      // ID real: obtener datos de la API\n      const donInfo = await fetchItemData(don.id);\n      donName = donInfo.name;\n      donIcon = donInfo.icon;\n    } else {\n      // ID ficticio: usar el ícono del primer ingrediente\n      const primerIng = don.manualIngredients[0];\n      const primerIngInfo = await fetchItemData(primerIng.id);\n      donIcon = primerIngInfo.icon;\n    }\n    // Renderizar mainIngredients en tabla separada si existen\n    let html = '';\n    // Para Don de la Suerte/Magia/Poder, SOLO una tabla anidada del árbol principal, sin encabezado ni títulos\n    const nombre = don.name ? don.name.toLowerCase() : '';\n    const esDonSimple = nombre.includes('suerte') || nombre.includes('magia') || nombre.includes('poder');\n    if (esDonSimple) {\n      if (don.mainIngredients && don.mainIngredients.length > 0) {\n        html += `<table class='table-modern-dones tabla-tarjetas'>\n          <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>`;\n        let totalBuy = 0;\n        let totalSell = 0;\n        for (const ing of don.mainIngredients) {\n          const result = await renderIngredientRowWithComponents(ing, 0);\n          html += result.html;\n          totalBuy += result.totalBuy || 0;\n          totalSell += result.totalSell || 0;\n        }\n        html += `</tbody></table>`;\n        if (totalBuy > 0 || totalSell > 0) {\n          html += `<div class='table-modern-totales' style='margin-bottom:50px;'>\n            <div class='precio-totales-dones'>\n              <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n              <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n            </div>\n          </div>`;\n        }\n      }\n      targetContainer.innerHTML += html;\n      return;\n    }\n    // Para otros dones, renderizado normal\n    if (!esDonSimple) {\n      html += `<h2 style='margin-top:18px;'><img src='${donIcon}' style='height:32px;vertical-align:middle;'> ${donName}</h2>`;\n    }\n    if (don.mainIngredients && don.mainIngredients.length > 0) {\n      html += `<table class='table-modern-dones tabla-tarjetas'>\n        <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>`;\n      \n      let totalBuy = 0;\n      let totalSell = 0;\n      \n      for (const ing of don.mainIngredients) {\n        const result = await renderIngredientRowWithComponents(ing, 0);\n        html += result.html;\n        totalBuy += result.totalBuy || 0;\n        totalSell += result.totalSell || 0;\n      }\n      \n      html += `</tbody></table>`;\n      \n      if (totalBuy > 0 || totalSell > 0) {\n        html += `<div class='table-modern-totales' style='margin-bottom:50px;'>\n          <div class='precio-totales-dones'>\n            <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n            <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n          </div>\n        </div>`;\n      }\n    }\n    // Para el Don de la Suerte, Don de la Magia y Don del Poder, NO renderizar tabla manualIngredients, solo el árbol completo\n    // Ya manejado arriba para esDonSimple\n    if (esDonSimple) return;\n    // El renderizado de ingredientes manuales ha sido eliminado completamente.\n    targetContainer.innerHTML += html;\n  } catch (e) {\n    errorMsg.innerText = e.message;\n    errorMsg.style.display = 'block';\n  }\n}\n\n// === Dones de armas legendarias Gen 1 ===\nasync function extractWeaponGifts() {\n  const { LEGENDARY_ITEMS } = window.LegendaryData || {};\n  const gifts = [];\n  const seen = new Set();\n  for (const item of Object.values(LEGENDARY_ITEMS)) {\n    if (!item.components) continue;\n    const gift = item.components.find(c => {\n      if (!c.name) return false;\n      const lower = c.name.toLowerCase();\n      return lower.startsWith('don de') && !lower.includes('la suerte') && !lower.includes('del dominio');\n    });\n    if (gift && !seen.has(gift.id)) {\n      seen.add(gift.id);\n      gifts.push({\n        id: gift.id,\n        name: gift.name,\n        mainIngredients: gift.components || [],\n        manualIngredients: []\n      });\n    }\n  }\n  // Orden alfabético por nombre\n  gifts.sort((a,b)=>a.name.localeCompare(b.name,'es'));\n  return gifts;\n}\n\n// Renderizar dones de armas legendarias de 1ra Gen\nasync function renderLegendaryWeaponGifts() {\n  const container = document.getElementById('dones-1ra-gen-content');\n  const skeleton = document.getElementById('dones-1ra-gen-skeleton');\n  if (!container || !skeleton) return;\n\n  showSkeleton(skeleton);\n  container.innerHTML = '';\n\n  try {\n    const gifts = await extractWeaponGifts();\n    const btnsDiv = document.createElement('div');\n    btnsDiv.className = 'don1gen-nav-btns';\n    btnsDiv.style = 'margin-bottom: 10%; display: flex; flex-wrap: wrap; gap: 10px;';\n\n    const resultDiv = document.createElement('div');\n    resultDiv.id = 'don1gen-result';\n\n    gifts.forEach((don) => {\n      const btn = document.createElement('button');\n      btn.className = 'dones-btn';\n      btn.textContent = don.name;\n      btn.addEventListener('click', async () => {\n        btnsDiv.querySelectorAll('button').forEach(b => b.classList.remove('active'));\n        btn.classList.add('active');\n        resultDiv.innerHTML = '';\n        showSkeleton(skeleton);\n        await renderDon(don, resultDiv);\n        hideSkeleton(skeleton);\n      });\n      btnsDiv.appendChild(btn);\n    });\n\n    container.appendChild(btnsDiv);\n    container.appendChild(resultDiv);\n  } catch (error) {\n    console.error('Error al renderizar dones de 1ra Gen:', error);\n    container.innerHTML = '<div class=\"error-message\">Error al cargar los dones.</div>';\n  } finally {\n    hideSkeleton(skeleton);\n  }\n}\n\n\n// Renderizar dones especiales (los que no son de armas)\nasync function renderSpecialDons() {\n  const container = document.getElementById('dones-content');\n  const skeleton = donesSkeleton;\n  showSkeleton(skeleton);\n  container.innerHTML = '';\n\n  // Renderizamos únicamente el Don de la Suerte (evitamos Magia y Poder para no duplicar tablas)\n  const specialDons = DONES.filter(d => d.name && d.name.toLowerCase().includes('suerte')); \n\n  for (const don of specialDons) {\n    const donContainer = document.createElement('div');\n    container.appendChild(donContainer);\n    await renderDon(don, donContainer);\n  }\n  hideSkeleton(skeleton);\n}\n\n// === Tributo Dracónico ===\nasync function getDraconicTribute() {\n  const { LEGENDARY_ITEMS_3GEN } = window.LegendaryData || {};\n  for (const weapon of Object.values(LEGENDARY_ITEMS_3GEN)) {\n    const tribute = weapon.components?.find(c => {\n      const nm = c.name?.toLowerCase() || '';\n      return nm.includes('tributo dracónico');\n    });\n    if (tribute) return tribute; // Es único, lo devolvemos\n  }\n  throw new Error('No se encontró el Tributo Dracónico en legendaryItems3gen');\n}\n\nasync function renderDraconicTribute() {\n  const container = document.getElementById('tributo-draconico-content');\n  const skeleton = document.getElementById('tributo-draconico-skeleton');\n  if (!container || !skeleton) return;\n\n  showSkeleton(skeleton);\n  container.innerHTML = '';\n\n  try {\n    const tributoTree = await getDraconicTribute();\n    let html = `<h2>${tributoTree.name}</h2>`;\n    html += `<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>`;\n\n    let totalBuy = 0;\n    let totalSell = 0;\n\n    // Renderizar cada componente de nivel superior del tributo\n    for (const component of tributoTree.components) {\n      const result = await renderIngredientRowWithComponents(component, 0);\n      html += result.html;\n      totalBuy += result.totalBuy || 0;\n      totalSell += result.totalSell || 0;\n    }\n\n    html += `</tbody></table>`;\n    html += `<div class='table-modern-totales' style='margin-bottom:50px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n      </div>\n    </div>`;\n\n    container.innerHTML = html;\n  } catch (e) {\n    console.error('Error al renderizar Tributo Dracónico:', e);\n    container.innerHTML = '<div class=\"error-message\">Error al cargar el Tributo Dracónico.</div>';\n  } finally {\n    hideSkeleton(skeleton);\n  }\n}\n\n// Exponer funciones de carga perezosa para cada pestaña\nconst _loadedTabs = {\n  special: false,\n  tributo: false,\n  draco: false,\n  gen1: false\n};\n\nasync function loadSpecialDons() {\n  if (_loadedTabs.special) return;\n  _loadedTabs.special = true;\n  await renderSpecialDons();\n}\n\nasync function loadTributo() {\n  if (_loadedTabs.tributo) return;\n  _loadedTabs.tributo = true;\n  await renderTributo();\n}\n\nasync function loadDraconicTribute() {\n  if (_loadedTabs.draco) return;\n  _loadedTabs.draco = true;\n  await renderDraconicTribute();\n}\n\nasync function loadDones1Gen() {\n  if (_loadedTabs.gen1) return;\n  _loadedTabs.gen1 = true;\n  await renderLegendaryWeaponGifts();\n}\n\nwindow.DonesPages = {\n  loadSpecialDons,\n  loadTributo,\n  loadDraconicTribute,\n  loadDones1Gen\n};\n\n// === Tributo Dracónico ===\nasync function renderTributoDraconico() {\n  const container = document.getElementById('tributo-draconico-content');\n  const tributoDraconicoSkeleton = document.getElementById('tributo-draconico-skeleton');\n  if (!container || !tributoDraconicoSkeleton) return;\n  showSkeleton(tributoDraconicoSkeleton);\n  container.innerHTML = '';\n  try {\n    if (TRIBUTO_DRACONICO.mainIngredients && TRIBUTO_DRACONICO.mainIngredients.length > 0) {\n      let html = `<h3>Ingredientes principales</h3>`;\n      html += `<table class='table-modern-dones tabla-tarjetas'><thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>`;\n      \n      // Variables para acumular totales\n      let totalBuy = 0;\n      let totalSell = 0;\n      let trebolBuy = 0;\n      let trebolSell = 0;\n      let piedrasBuy = 0;\n      let piedrasSell = 0;\n      \n      // Procesar cada ingrediente principal\n      for (const ing of TRIBUTO_DRACONICO.mainIngredients) {\n        const result = await renderIngredientRowWithComponents(ing, 0);\n        html += result.html;\n        \n        // Solo sumar tréboles y piedras imán dracónicas\n        if (ing.id === 19675) { // Trébol místico\n          trebolBuy = result.totalBuy || 0;\n          trebolSell = result.totalSell || 0;\n        } else if (ing.id === 92687) { // Piedra imán dracónica amalgamada (ID corregido)\n          piedrasBuy = result.totalBuy || 0;\n          piedrasSell = result.totalSell || 0;\n        } else {\n        }\n      }\n      \n      // Sumar solo los 38 tréboles y 5 piedras imán dracónicas\n      totalBuy = trebolBuy + piedrasBuy;\n      totalSell = trebolSell + piedrasSell;\n      \n      \n      html += `</tbody></table>`;\n      html += `<div class=\"table-modern-totales\" style=\"margin-bottom:50px;\">\n        <div class=\"precio-totales-dones\">\n          <div class=\"total-dones\"><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n          <div class=\"total-dones\"><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n        </div>\n      </div>`;\n      document.getElementById('tributo-draconico-content').insertAdjacentHTML('beforeend', html);\n    }\n    for (const don of TRIBUTO_DRACONICO.dons) {\n      const donDiv = document.createElement('div');\n      donDiv.className = 'don-section';\n      const donTitle = document.createElement('h3');\n      donTitle.textContent = don.name;\n      donDiv.appendChild(donTitle);\n      for (const subdon of don.subdons) {\n        const subdonDiv = document.createElement('div');\n        subdonDiv.className = 'subdon-section';\n        const subdonTitle = document.createElement('h4');\n        subdonTitle.textContent = subdon.name;\n        subdonDiv.appendChild(subdonTitle);\n        // Obtener datos de ingredientes\n        const ingredientes = await Promise.all(subdon.ingredients.map(async ing => {\n          const [info, price] = await Promise.all([\n            fetchItemData(ing.id),\n            fetchPriceData(ing.id)\n          ]);\n          return {\n            id: ing.id,\n            name: info.name,\n            icon: info.icon,\n            count: ing.count,\n            priceBuy: price ? price.buys.unit_price : null,\n            priceSell: price ? price.sells.unit_price : null\n          };\n        }));\n        // Renderizar tabla con lógica tradicional\n        let totalBuy = 0;\n        let totalSell = 0;\n        let rowsHtml = '';\n        ingredientes.forEach((ing, idx) => {\n          const totalBuyIng = ing.priceBuy ? ing.priceBuy * ing.count : null;\n          const totalSellIng = ing.priceSell ? ing.priceSell * ing.count : null;\n          if (totalBuyIng) totalBuy += totalBuyIng;\n          if (totalSellIng) totalSell += totalSellIng;\n          rowsHtml += `\n            <tr data-id='${ing.id}' class='${idx % 2 === 0 ? 'row-bg-a' : 'row-bg-b'}'>\n              <td><img src='${ing.icon}' style='height:28px;'></td>\n              <td>${ing.name}</td>\n              <td>${Math.round(ing.count)}</td>\n              <td>${ing.priceBuy ? formatGoldColored(ing.priceBuy) : '-'}</td>\n              <td>${ing.priceSell ? formatGoldColored(ing.priceSell) : '-'}</td>\n              <td>${totalBuyIng ? formatGoldColored(totalBuyIng) : '-'}</td>\n              <td>${totalSellIng ? formatGoldColored(totalSellIng) : '-'}</td>\n            </tr>`;\n        });\n\n        const tableHtml = `<table class='table-modern-dones tabla-tarjetas'>\n          <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead>\n          <tbody>${rowsHtml}</tbody>\n        </table>`;\n        subdonDiv.insertAdjacentHTML('beforeend', tableHtml);\n\n        const totalsHtml = `<div class='table-modern-totales' style='margin-bottom:50px;'>\n          <div class='precio-totales-dones'>\n            <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n            <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n          </div>\n        </div>`;\n        subdonDiv.insertAdjacentHTML('beforeend', totalsHtml);\n        donDiv.appendChild(subdonDiv);\n      }\n      container.appendChild(donDiv);\n    }\n  } catch (e) {\n    container.innerHTML = '<div class=\"error-message\">Error al cargar el Tributo Dracónico.</div>';\n  } finally {\n    hideSkeleton(tributoDraconicoSkeleton);\n  }\n}\n\n\n\n// === Tributo Místico ===\nconst TRIBUTO = {\n  name: \"Tributo Místico\",\n  mainIngredients: [\n    { id: 19675, name: \"Trébol místico\", type: \"account_bound\", count: 77, components: [\n  { id: 19976, name: \"Moneda mística\", count: 250 },\n  { id: 19721, name: \"Pegote de ectoplasma\", count: 250 },\n  { id: 19925, name: \"Esquirla de obsidiana\", count: 250 },\n  { id: 20796, name: \"Piedra filosofal\", count: 1500 }\n]},\n    { id: 19976, name: \"Moneda mística\", count: 250 }\n  ],\n  dons: [\n    {\n      name: \"Don de magia condensada\",\n      subdons: [\n        {\n          name: \"Don de sangre\",\n          ingredients: [\n            { id: 24295, name: \"Vial de sangre poderosa\", count: 100 },\n            { id: 24294, name: \"Vial de sangre potente\", count: 250 },\n            { id: 24293, name: \"Vial de sangre espesa\", count: 50 },\n            { id: 24292, name: \"Vial de sangre\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de veneno\",\n          ingredients: [\n            { id: 24283, name: \"Vesícula de veneno poderoso\", count: 100 },\n            { id: 24282, name: \"Vesícula de veneno potente\", count: 250 },\n            { id: 24281, name: \"Vesícula de veneno llena\", count: 50 },\n            { id: 24280, name: \"Vesícula de veneno\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de tótems\",\n          ingredients: [\n            { id: 24300, name: \"Tótem elaborado\", count: 100 },\n            { id: 24299, name: \"Tótem intrincado\", count: 250 },\n            { id: 24298, name: \"Tótem grabado\", count: 50 },\n            { id: 24297, name: \"Tótem\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de polvo\",\n          ingredients: [\n            { id: 24277, name: \"Montón de polvo cristalino\", count: 100 },\n            { id: 24276, name: \"Montón de polvo incandescente\", count: 250 },\n            { id: 24275, name: \"Montón de polvo luminoso\", count: 50 },\n            { id: 24274, name: \"Montón de polvo radiante\", count: 50 },\n          ]\n        },\n      ]\n    },\n    {\n      name: \"Don de poder condensado\",\n      subdons: [\n        {\n          name: \"Don de garras\",\n          ingredients: [\n            { id: 24351, name: \"Garra despiadada\", count: 100 },\n            { id: 24350, name: \"Garra grande\", count: 250 },\n            { id: 24349, name: \"Garra afilada\", count: 50 },\n            { id: 24348, name: \"Garra\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de escamas\",\n          ingredients: [\n            { id: 24289, name: \"Escama blindada\", count: 100 },\n            { id: 24288, name: \"Escama grande\", count: 250 },\n            { id: 24287, name: \"Escama suave\", count: 50 },\n            { id: 24286, name: \"Escama\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de huesos\",\n          ingredients: [\n            { id: 24358, name: \"Hueso antiguo\", count: 100 },\n            { id: 24341, name: \"Hueso grande\", count: 250 },\n            { id: 24345, name: \"Hueso pesado\", count: 50 },\n            { id: 24344, name: \"Hueso\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de colmillos\",\n          ingredients: [\n            { id: 24357, name: \"Colmillo feroz\", count: 100 },\n            { id: 24356, name: \"Colmillo grande\", count: 250 },\n            { id: 24355, name: \"Colmillo afilado\", count: 50 },\n            { id: 24354, name: \"Colmillo\", count: 50 },\n          ]\n        },\n      ]\n    }\n  ]\n};\n\n// === Tributo Dracónico ===\nconst TRIBUTO_DRACONICO = {\n  name: \"Tributo dracónico\",\n  mainIngredients: [\n    { id: 19675, name: \"Trébol místico\", type: \"account_bound\", count: 38, components: [\n  { id: 19976, name: \"Moneda mística\", count: 38 },\n  { id: 19721, name: \"Pegote de ectoplasma\", count: 38 },\n  { id: 19925, name: \"Esquirla de obsidiana\", count: 38 },\n  { id: 20796, name: \"Piedra filosofal\", count: 228 }\n]},\n    { id: 92687, name: \"Piedra imán dracónica amalgamada\", count: 5 }\n  ],\n  dons: [\n    {\n      name: \"Don de magia condensada\",\n      subdons: [\n        {\n          name: \"Don de sangre\",\n          ingredients: [\n            { id: 24295, name: \"Vial de sangre poderosa\", count: 100 },\n            { id: 24294, name: \"Vial de sangre potente\", count: 250 },\n            { id: 24293, name: \"Vial de sangre espesa\", count: 50 },\n            { id: 24292, name: \"Vial de sangre\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de veneno\",\n          ingredients: [\n            { id: 24283, name: \"Vesícula de veneno poderoso\", count: 100 },\n            { id: 24282, name: \"Vesícula de veneno potente\", count: 250 },\n            { id: 24281, name: \"Vesícula de veneno llena\", count: 50 },\n            { id: 24280, name: \"Vesícula de veneno\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de tótems\",\n          ingredients: [\n            { id: 24300, name: \"Tótem elaborado\", count: 100 },\n            { id: 24299, name: \"Tótem intrincado\", count: 250 },\n            { id: 24298, name: \"Tótem grabado\", count: 50 },\n            { id: 24297, name: \"Tótem\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de polvo\",\n          ingredients: [\n            { id: 24277, name: \"Montón de polvo cristalino\", count: 100 },\n            { id: 24276, name: \"Montón de polvo incandescente\", count: 250 },\n            { id: 24275, name: \"Montón de polvo luminoso\", count: 50 },\n            { id: 24274, name: \"Montón de polvo radiante\", count: 50 }\n          ]\n        }\n      ]\n    },\n    {\n      name: \"Don de poder condensado\",\n      subdons: [\n        {\n          name: \"Don de garras\",\n          ingredients: [\n            { id: 24351, name: \"Garra despiadada\", count: 50 },\n            { id: 24350, name: \"Garra grande\", count: 250 },\n            { id: 24349, name: \"Garra afilada\", count: 50 },\n            { id: 24348, name: \"Garra\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de escamas\",\n          ingredients: [\n            { id: 24289, name: \"Escama blindada\", count: 50 },\n            { id: 24288, name: \"Escama grande\", count: 250 },\n            { id: 24287, name: \"Escama suave\", count: 50 },\n            { id: 24286, name: \"Escama\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de huesos\",\n          ingredients: [\n            { id: 24358, name: \"Hueso antiguo\", count: 50 },\n            { id: 24341, name: \"Hueso grande\", count: 250 },\n            { id: 24345, name: \"Hueso pesado\", count: 50 },\n            { id: 24344, name: \"Hueso\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de colmillos\",\n          ingredients: [\n            { id: 24357, name: \"Colmillo feroz\", count: 50 },\n            { id: 24356, name: \"Colmillo grande\", count: 250 },\n            { id: 24355, name: \"Colmillo afilado\", count: 50 },\n            { id: 24354, name: \"Colmillo\", count: 50 }\n          ]\n        }\n      ]\n    }\n  ]\n};\n\n// Renderiza una fila y sus subcomponentes recursivamente\n// Devuelve un objeto con {html, totalBuy, totalSell}\nasync function renderIngredientRowWithComponents(ing, level = 0) {\n  const { tree } = await buildWorkerTree([ing]);\n  const node = tree[0];\n  const html = renderNodeHtml(node, level);\n  return { html, totalBuy: node.total_buy || 0, totalSell: node.total_sell || 0 };\n}\n\n// Construye un árbol de componentes completo y unificado para el Tributo Místico\nfunction buildTributoTree() {\n  const root = {\n    id: 'TRIBUTO_MISTICO_ROOT',\n    name: TRIBUTO.name,\n    count: 1,\n    components: []\n  };\n\n  // 1. Añadir ingredientes principales (Trébol Místico)\n  // renderIngredientRowWithComponents se encargará de sus sub-componentes\n  TRIBUTO.mainIngredients.forEach(ing => {\n    root.components.push({ ...ing });\n  });\n\n  // 2. Procesar los dones principales (Magia y Poder Condensado)\n  TRIBUTO.dons.forEach(don => {\n        const donCount = (don.name.toLowerCase().includes('magia condensada') || don.name.toLowerCase().includes('poder condensado')) ? 2 : 1;\n    const donNode = {\n      id: don.name.replace(/\\s+/g, '_').toUpperCase(), // ID único para el don\n      name: don.name,\n      count: donCount,\n      components: []\n    };\n\n    // 3. Procesar los subdones (Sangre, Veneno, etc.)\n    don.subdons.forEach(subdon => {\n      const subdonNode = {\n        id: subdon.name.replace(/\\s+/g, '_').toUpperCase(), // ID único para el subdon\n        name: subdon.name,\n        count: 1,\n        components: []\n      };\n      \n      // 4. Añadir los ingredientes finales al subdon\n      subdon.ingredients.forEach(ingredient => {\n        subdonNode.components.push({ ...ingredient });\n      });\n      \n      donNode.components.push(subdonNode);\n    });\n    \n    root.components.push(donNode);\n  });\n\n  return root;\n}\n\n\n// Renderiza el Tributo Místico como un árbol único y anidado\nasync function renderTributo() {\n  const container = document.getElementById('tributo-content');\n  const skeleton = document.getElementById('tributo-skeleton');\n  if (!container || !skeleton) return;\n\n  showSkeleton(skeleton);\n  container.innerHTML = ''; // Limpiar contenido previo\n\n  try {\n    const tributoTree = buildTributoTree();\n\n    let html = `<h2>${tributoTree.name}</h2>`;\n    html += `<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>`;\n\n    let totalBuy = 0;\n    let totalSell = 0;\n\n    // Renderizar cada componente de nivel superior del árbol de forma recursiva\n    for (const component of tributoTree.components) {\n      const result = await renderIngredientRowWithComponents(component, 0); // Iniciar en nivel 0\n      html += result.html;\n      totalBuy += result.totalBuy || 0;\n      totalSell += result.totalSell || 0;\n    }\n\n    html += `</tbody></table>`;\n\n    // Mostrar los totales generales\n    html += `<div class='table-modern-totales' style='margin-bottom:18px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n      </div>\n    </div>`;\n\n    container.innerHTML = html;\n\n  } catch (error) {\n    console.error(\"Error al renderizar Tributo Místico:\", error);\n    container.innerHTML = '<div class=\"error-message\">Error al cargar el Tributo Místico.</div>';\n  } finally {\n    hideSkeleton(skeleton);\n  }\n}\n\n\n","import './dones.js';\nimport fetchWithRetry from './utils/fetchWithRetry.js';\n// Bundled dones core and tabs\n(function(){\nconst API_ITEM = 'https://api.guildwars2.com/v2/items/';\nconst API_PRICES = 'https://api.guildwars2.com/v2/commerce/prices/';\nconst itemCache = new Map();\nconst priceCache = new Map();\n\nconst FIXED_PRICE_ITEMS = { 19676: 10000 };\n\nconst EXCLUDED_ITEM_IDS = [\n  19675, 19925, 20796, 19665, 19674, 19626, 19672, 19673,\n  19645, 19650, 19655, 19639, 19635, 19621, 20799 // Cristal místico (no comerciable)\n];\n\nconst isGiftName = function(name){\n  if(!name) return false;\n  const lower = name.toLowerCase();\n  return lower.startsWith('don de ') || lower.startsWith('don del ') || lower.startsWith('don de la ');\n};\n\nconst shouldSkipMarketCheck = function(id){\n  return EXCLUDED_ITEM_IDS.includes(id);\n};\n\nconst fetchItemData = async function(id) {\n  if (itemCache.has(id)) return itemCache.get(id);\n  const stored = sessionStorage.getItem('item:' + id);\n  if (stored) {\n    const data = JSON.parse(stored);\n    itemCache.set(id, data);\n    return data;\n  }\n  const res = await fetchWithRetry(API_ITEM + id);\n  if (!res.ok) throw new Error('No se pudo obtener info de item ' + id);\n  const json = await res.json();\n  itemCache.set(id, json);\n  try { sessionStorage.setItem('item:' + id, JSON.stringify(json)); } catch(e) {}\n  return json;\n};\n\nconst fetchPriceData = async function(id) {\n  if (FIXED_PRICE_ITEMS[id] !== undefined) {\n    const value = FIXED_PRICE_ITEMS[id];\n    return {buys:{unit_price:value}, sells:{unit_price:value}};\n  }\n  if(shouldSkipMarketCheck(id)) return null;\n  if (priceCache.has(id)) return priceCache.get(id);\n  const stored = sessionStorage.getItem('price:' + id);\n  if (stored) {\n    const data = JSON.parse(stored);\n    priceCache.set(id, data);\n    return data;\n  }\n  const res = await fetchWithRetry(API_PRICES + id);\n  if (!res.ok) return null;\n  const json = await res.json();\n  priceCache.set(id, json);\n  try { sessionStorage.setItem('price:' + id, JSON.stringify(json)); } catch(e){}\n  return json;\n};\n\nif (typeof window !== 'undefined') {\n  window.DonesCore = { fetchItemData, fetchPriceData, isGiftName, shouldSkipMarketCheck };\n}\n// Manejo de pestañas en dones.html\ndocument.addEventListener('DOMContentLoaded', async function() {\n  await import('./tabs.min.js');\n  const loaded = {};\n\n  function handleTab(tabId) {\n    localStorage.setItem('activeDonTab', tabId);\n    if (!loaded[tabId] && window.DonesPages) {\n      loaded[tabId] = true;\n      if (tabId === 'tab-don-suerte') window.DonesPages.loadSpecialDons();\n      else if (tabId === 'tab-tributo-mistico') window.DonesPages.loadTributo();\n      else if (tabId === 'tab-tributo-draconico') window.DonesPages.loadDraconicTribute();\n      else if (tabId === 'dones-1ra-gen') window.DonesPages.loadDones1Gen();\n    }\n  }\n\n  document.addEventListener('tabchange', e => {\n    handleTab(e.detail.tabId);\n  });\n\n  const savedTab = localStorage.getItem('activeDonTab');\n  const target = savedTab\n    ? document.querySelector(`.tab-button[data-tab=\"${savedTab}\"]`)\n    : document.querySelector('.tab-button[data-tab]');\n  if (target) target.click();\n});\n})();\n"],"names":["fetchItemData","fetchPriceData","window","DonesCore","DONES","id","name","mainIngredients","type","count","components","manualIngredients","document","getElementById","donesSkeleton","errorMsg","showSkeleton","hideSkeleton","donesWorkerInstance","costsWorkerInstance","async","buildWorkerTree","ings","ingredientTree","rootIngredients","Worker","URL","url","Promise","resolve","reject","handleMessage","e","removeEventListener","handleError","data","err","innerText","message","style","display","terminate","addEventListener","postMessage","updatedTree","totals","globalQty","workerUrl","COSTS_WORKER_HASH","__APP_VERSION__","runCostsWorker","restoreCraftIngredientPrototypes","tree","renderNodeHtml","node","level","indent","priceBuy","buy_price","formatGoldColored","priceSell","sell_price","totalBuy","total_buy","totalSell","total_sell","rowHtml","icon","Math","round","Array","isArray","children","child","renderDon","don","container","targetContainer","innerHTML","donName","donIcon","donInfo","primerIng","html","nombre","toLowerCase","esDonSimple","includes","length","ing","result","renderIngredientRowWithComponents","renderLegendaryWeaponGifts","skeleton","gifts","LEGENDARY_ITEMS","LegendaryData","seen","Set","item","Object","values","gift","find","c","lower","startsWith","has","add","push","sort","a","b","localeCompare","extractWeaponGifts","btnsDiv","createElement","className","resultDiv","forEach","btn","textContent","querySelectorAll","classList","remove","appendChild","error","console","renderDraconicTribute","tributoTree","LEGENDARY_ITEMS_3GEN","weapon","tribute","Error","getDraconicTribute","component","_loadedTabs","special","tributo","draco","gen1","DonesPages","loadSpecialDons","specialDons","filter","d","donContainer","renderSpecialDons","loadTributo","root","TRIBUTO","dons","donCount","donNode","replace","toUpperCase","subdons","subdon","subdonNode","ingredients","ingredient","buildTributoTree","renderTributo","loadDraconicTribute","loadDones1Gen","itemCache","Map","priceCache","FIXED_PRICE_ITEMS","EXCLUDED_ITEM_IDS","isGiftName","shouldSkipMarketCheck","get","stored","sessionStorage","getItem","JSON","parse","set","res","fetchWithRetry","ok","json","setItem","stringify","undefined","value","buys","unit_price","sells","import","loaded","tabId","detail","localStorage","savedTab","target","querySelector","click"],"mappings":"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"}