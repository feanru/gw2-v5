{"version":3,"file":"bundle-auth-nav.CqVBeA8h.min.js","sources":["../../src/js/bundle-auth-nav.js"],"sourcesContent":["import fetchWithRetry from './utils/fetchWithRetry.js';\n// Bundled auth and navigation helpers\n\n// ==== auth.js content ====\nlet currentUser = null;\n\nasync function fetchCurrentUser() {\n    try {\n        const r = await fetchWithRetry('backend/api/user.php');\n        if (!r.ok) return null;\n        return r.json();\n    } catch (e) {\n        return null;\n    }\n}\n\nasync function initAuth() {\n    currentUser = await fetchCurrentUser();\n    updateAuthUI();\n    return currentUser;\n}\n\nfunction updateAuthUI() {\n    document.dispatchEvent(new CustomEvent('auth-updated', { detail: currentUser }));\n}\n\nfunction loginWithGoogle() {\n    window.location.href = 'backend/auth.php?provider=google';\n}\n\n\nfunction logout() {\n    currentUser = null;\n    updateAuthUI();\n    navigator.serviceWorker?.controller?.postMessage({ type: 'invalidateAll' });\n    window.location.href = 'backend/logout.php';\n}\n\nfunction requireAuth() {\n    if (!currentUser) {\n        window.location.href = '/login';\n        return false;\n    }\n    return true;\n}\n\nfunction loginWithDiscord() {\n    window.location.href = 'backend/auth.php?provider=discord';\n}\n\nwindow.Auth = {\n    get currentUser() { return currentUser; },\n    initAuth,\n    loginWithGoogle,\n    loginWithDiscord,\n    logout,\n    requireAuth\n};\n\n// ==== navigation.js partial content ====\n// Theme manager and navigation creation\nconst ThemeManager = {\n    init() {\n        this.theme = localStorage.getItem('theme') || 'dark';\n        this.applyTheme();\n    },\n\n    toggleTheme() {\n        this.theme = this.theme === 'dark' ? 'light' : 'dark';\n        localStorage.setItem('theme', this.theme);\n        this.applyTheme();\n    },\n\n    applyTheme() {\n        document.body.classList.toggle('light-theme', this.theme === 'light');\n        document.body.classList.toggle('dark-theme', this.theme === 'dark');\n\n        const bg = document.getElementById('bg-video');\n        const overlay = document.getElementById('bg-overlay');\n        if (bg) {\n            bg.classList.toggle('dark', this.theme === 'dark');\n        }\n        if (overlay) {\n            overlay.style.background = this.theme === 'dark'\n                ? 'rgba(0,0,0,0.1)'\n                : 'rgba(255,255,255,0.6)';\n        }\n\n        const themeButtons = document.querySelectorAll('.theme-toggle');\n        themeButtons.forEach(btn => {\n            btn.textContent = this.theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';\n        });\n    }\n};\n\nconst navigationData = {\n    menuItems: [\n        { text: 'Inicio', href: '/', target: 'tab-detalles', class: '' },\n        { text: 'Dones', href: '/dones', target: 'tab-crafteo', class: '' },\n        { text: 'Comparativa', href: '/compare-craft', target: 'tab-comparativa', class: '', requiresLogin: true },\n        { text: 'Fractales', href: '/fractales-gold', target: 'tab-fractales', class: '', requiresLogin: true },\n        { text: 'Legendarias', href: '/leg-craft', target: 'tab-leg-craft', class: '' },\n        { text: 'Forja M√≠stica', href: '/forja-mistica', target: 'tab-forja-mistica', class: '' }\n    ],\n    rightMenuItems: [\n        {\n            text: 'üåô',\n            href: '#',\n            target: '',\n            class: 'right-btn theme-toggle',\n            id: 'theme-toggle',\n            onClick: (e) => {\n                e.preventDefault();\n                ThemeManager.toggleTheme();\n            }\n        },\n        {\n            text: 'Iniciar sesi√≥n',\n            href: '#',\n            target: '',\n            class: 'right-btn',\n            id: 'loginBtn',\n            onClick: (e) => {\n                e.preventDefault();\n                window.location.href = '/login';\n            }\n        },\n        {\n            text: '',\n            href: '#',\n            target: '',\n            class: 'right-btn requires-login',\n            id: 'userInfo',\n            style: 'padding: 0 10px;',\n            onClick: (e) => {\n                e.preventDefault();\n                showAccountModal();\n            }\n        }\n    ]\n};\nfunction updateAuthMenu() {\n    const loginBtn = document.getElementById('loginBtn');\n    const userInfo = document.getElementById('userInfo');\n    const user = currentUser;\n    const isLoggedIn = !!user;\n    document.body.classList.toggle('logged-in', isLoggedIn);\n    if (loginBtn) loginBtn.classList.toggle('hidden', isLoggedIn);\n\n    function toggleLoginElements() {\n        document.querySelectorAll('[data-requires-login]').forEach(el => {\n            el.classList.toggle('requires-login', !isLoggedIn);\n        });\n    }\n\n    toggleLoginElements();\n\n    if (isLoggedIn && user && userInfo) {\n        userInfo.innerHTML = `\n            <img src=\"${user.avatar || 'https://via.placeholder.com/24'}\" alt=\"avatar\" style=\"width:24px;height:24px;border-radius:50%;vertical-align:middle;margin-right:5px;\">\n            ${user.name || 'Usuario'}\n        `;\n        userInfo.onclick = (e) => {\n            e.preventDefault();\n            showAccountModal();\n        };\n    }\n\n    const activeBtn = document.querySelector('.tab-button.active');\n    if (activeBtn) {\n        const tabId = activeBtn.getAttribute('data-tab');\n        if (tabId && typeof window.switchTab === 'function') {\n            window.switchTab(tabId);\n        }\n    }\n}\n\nfunction showAuthOptions() {\n    let modal = document.getElementById('auth-modal');\n    if (!modal) {\n        modal = document.createElement('div');\n        modal.id = 'auth-modal';\n        modal.className = 'modal-overlay';\n        modal.innerHTML = `\n            <div class=\"auth-modal-content\">\n                <h3 style='margin-bottom:18px;color:#fff;'>Iniciar sesi√≥n</h3>\n                <button id=\"google-login-btn\" class=\"auth-btn google-btn\">\n                    <img src=\"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/google/google-original.svg\" alt=\"google\"> Google\n                </button>\n                <button id=\"discord-login-btn\" class=\"auth-btn discord-btn\">\n                    <img src=\"https://cdn.jsdelivr.net/gh/devicons/devicon/icons/discordjs/discordjs-original.svg\" alt=\"discord\"> Discord\n                </button>\n                <a href=\"/login\" class=\"auth-classic-link\">¬øPrefieres iniciar sesi√≥n cl√°sico?</a>\n                <button onclick=\"document.getElementById('auth-modal').remove()\" class=\"auth-cancel-btn\">Cancelar</button>\n            </div>`;\n        document.body.appendChild(modal);\n        document.getElementById('google-login-btn').onclick = () => {\n            if (window.Auth && window.Auth.loginWithGoogle) window.Auth.loginWithGoogle();\n        };\n        document.getElementById('discord-login-btn').onclick = () => {\n            if (window.Auth && window.Auth.loginWithDiscord) window.Auth.loginWithDiscord();\n        };\n    }\n}\n\nfunction showAccountModal() {\n    const existing = document.getElementById('account-modal');\n    if (existing) return;\n\n    const user = currentUser;\n    if (!user) return;\n\n    const modal = document.createElement('div');\n    modal.id = 'account-modal';\n    modal.className = 'modal-overlay';\n    modal.innerHTML = `\n        <div class=\"account-modal-content\">\n            <img src=\"${user.avatar || 'https://via.placeholder.com/64'}\" class=\"account-avatar\" alt=\"avatar\">\n            <div class=\"account-name\">${user.name || 'Usuario'}</div>\n            <div class=\"account-email\">${user.email || ''}</div>\n            <a href=\"/cuenta\" class=\"account-link\">Mi Cuenta</a>\n            <button onclick=\"window.Auth && window.Auth.logout && window.Auth.logout()\" class=\"logout-btn\">Cerrar sesi√≥n</button>\n            <button class=\"close-account-btn\">Cerrar</button>\n        </div>`;\n    document.body.appendChild(modal);\n\n    const close = () => modal.remove();\n    modal.addEventListener('click', (e) => {\n        if (e.target === modal) close();\n    });\n    modal.querySelector('.close-account-btn').addEventListener('click', close);\n}\n\nfunction createNavigation() {\n    const nav = document.createElement('nav');\n    nav.className = 'topbar item-tabs-bar';\n\n    const menuCenter = document.createElement('div');\n    menuCenter.className = 'menu-center';\n\n    navigationData.menuItems.forEach(item => {\n        const link = document.createElement('a');\n        link.href = item.href;\n        link.className = `item-tab ${item.class}`.trim();\n        if (item.target) link.setAttribute('data-target', item.target);\n        if (item.requiresLogin) link.classList.add('requires-login');\n        link.textContent = item.text;\n        menuCenter.appendChild(link);\n    });\n\n    const menuRight = document.createElement('div');\n    menuRight.className = 'menu-right';\n\n    navigationData.rightMenuItems.forEach(item => {\n        const link = document.createElement('a');\n        link.href = item.href;\n        link.className = `item-tab ${item.class}`.trim();\n        if (item.target) link.setAttribute('data-target', item.target);\n        if (item.id) link.id = item.id;\n        link.textContent = item.text;\n        if (item.onClick) link.addEventListener('click', item.onClick);\n        menuRight.appendChild(link);\n    });\n\n    nav.appendChild(menuCenter);\n    nav.appendChild(menuRight);\n\n    return nav;\n}\n\nfunction initNavigation() {\n    const header = document.querySelector('header');\n    if (header) {\n        const nav = createNavigation();\n        header.insertBefore(nav, header.firstChild);\n        ThemeManager.init();\n        updateAuthMenu();\n        nav.querySelectorAll('a.item-tab').forEach(link => {\n            if (link.id !== 'userInfo') {\n                link.addEventListener('click', () => {\n                    const modal = document.getElementById('account-modal');\n                    if (modal) modal.remove();\n                });\n            }\n        });\n    }\n}\ndocument.addEventListener('auth-updated', updateAuthMenu);\n\nfunction onReady() {\n    initNavigation();\n    initAuth();\n}\n\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', onReady);\n} else {\n    onReady();\n}\n\nwindow.updateAuthMenu = updateAuthMenu;\nwindow.showAuthOptions = showAuthOptions;\nwindow.showAccountModal = showAccountModal;\n"],"names":["currentUser","async","initAuth","r","fetchWithRetry","ok","json","e","fetchCurrentUser","updateAuthUI","document","dispatchEvent","CustomEvent","detail","window","Auth","loginWithGoogle","location","href","loginWithDiscord","logout","navigator","serviceWorker","controller","postMessage","type","requireAuth","ThemeManager","init","this","theme","localStorage","getItem","applyTheme","toggleTheme","setItem","body","classList","toggle","bg","getElementById","overlay","style","background","querySelectorAll","forEach","btn","textContent","navigationData","menuItems","text","target","class","requiresLogin","rightMenuItems","id","onClick","preventDefault","showAccountModal","updateAuthMenu","loginBtn","userInfo","user","isLoggedIn","el","innerHTML","avatar","name","onclick","activeBtn","querySelector","tabId","getAttribute","switchTab","modal","createElement","className","email","appendChild","close","remove","addEventListener","initNavigation","header","nav","menuCenter","item","link","trim","setAttribute","add","menuRight","createNavigation","insertBefore","firstChild","onReady","readyState","showAuthOptions"],"mappings":"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"}