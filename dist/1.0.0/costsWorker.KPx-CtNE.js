class t{constructor({id:e,name:i,icon:l,rarity:r,count:s,buy_price:a,sell_price:c,is_craftable:n,recipe:o,children:h=[],_parentId:u=null}){this._uid=t.nextUid++,this.id=e,this.name=i,this.icon=l,this.rarity=r,this.count=s,this.buy_price=a,this.sell_price=c,this.is_craftable=n,this.recipe=o||null,this.children=h,this.mode="buy",this.modeForParentCrafted="buy",this.expanded=!1,this._parentId=u,this._parent=null,this.countTotal=0,this.crafted_price=null,this.total_buy=0,this.total_sell=0,this.total_crafted=0}findRoot(){let t=this;for(;t._parent;)t=t._parent;return t}setMode(t){if(["buy","sell","crafted"].includes(t)){this.modeForParentCrafted=t;this.findRoot().recalc(globalThis.globalQty||1,null),"function"==typeof globalThis.safeRenderTable&&globalThis.safeRenderTable()}}recalc(t=1,e=null){const i=null==e,l=19675===this.id&&(77===this.count||38===this.count);if(this.countTotal=i?this.count*t:l?this.count:e.countTotal*this.count,this.children&&this.children.length>0)if(l){const t=77===this.count?[250,250,250,1500]:[38,38,38,38];this.children.forEach((e,i)=>{e.countTotal=t[i]||0,e.total_buy=(e.buy_price||0)*e.countTotal,e.total_sell=(e.sell_price||0)*e.countTotal})}else this.children.forEach(e=>e.recalc(t,this));i||l?(this.total_buy=this.children.reduce((t,e)=>t+(e.total_buy||0),0),this.total_sell=this.children.reduce((t,e)=>t+(e.total_sell||0),0)):(this.total_buy=(this.buy_price||0)*this.countTotal,this.total_sell=(this.sell_price||0)*this.countTotal),this.is_craftable&&this.children.length>0?(this.total_crafted=this.children.reduce((t,e)=>{switch(e.modeForParentCrafted){case"sell":return t+(e.total_sell||0);case"crafted":return t+(e.total_crafted||0);default:return t+(e.total_buy||0)}},0),this.crafted_price=this.total_crafted/(this.recipe?.output_item_count||1),i||this.buy_price||this.sell_price||(this.total_buy=this.children.reduce((t,e)=>t+(e.total_buy||0),0),this.total_sell=this.children.reduce((t,e)=>t+(e.total_sell||0),0))):(this.total_crafted=null,this.crafted_price=null)}getBestPrice(){return"number"==typeof this.buy_price&&this.buy_price>0?this.buy_price:"number"==typeof this.crafted_price&&this.crafted_price>0?this.crafted_price:0}}t.nextUid=0;const e="undefined"!=typeof self?self:globalThis;function i(t){return Array.isArray(t)?t.map(t=>l(t,null)):[]}function l(e,i){const r=new t(e);return Object.assign(r,e),"number"==typeof e._uid&&(r._uid=e._uid,t.nextUid<=e._uid&&(t.nextUid=e._uid+1)),r._parent=i||null,r.children=Array.isArray(e.children)?e.children.map(t=>l(t,r)):[],r}function r(t,e){t&&t.forEach(t=>{t.recalc(e,null)})}function s(t){let e=0,i=0,l=0;for(const r of t)switch(e+=r.total_buy||0,i+=r.total_sell||0,r.modeForParentCrafted){case"sell":l+=r.total_sell||0;break;case"crafted":l+=r.total_crafted||0;break;default:l+=r.total_buy||0}return{totalBuy:e,totalSell:i,totalCrafted:l}}e.onmessage=t=>{const{ingredientTree:l,globalQty:a}=t.data||{},c=i(l);r(c,a);const n=s(c);e.postMessage({updatedTree:c,totals:n})};export{s as getTotals,i as rebuildTreeArray,r as recalcAll};
//# sourceMappingURL=costsWorker.KPx-CtNE.v1.0.0.js.map
