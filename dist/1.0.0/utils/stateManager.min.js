const renderers=new Map,visibility=new WeakMap,observer=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target;if(visibility.set(t,e.isIntersecting),e.isIntersecting){const e=t.dataset.stateId||t.dataset.path;if(!e)return;const r=renderers.get(e);if(!r)return;const n=r.find(e=>e.el===t),s=t._pendingState;n&&s&&(n.renderFn(s),t._pendingState=null)}})});export function register(e,t,r){const n=String(e);t.dataset.stateId=n;let s=renderers.get(n);s||(s=[],renderers.set(n,s)),s.push({el:t,renderFn:r}),observer.observe(t)}export function update(e,t){const r=renderers.get(String(e));r&&r.forEach(({el:e,renderFn:r})=>{visibility.get(e)?r&&r(t):e._pendingState=t})}