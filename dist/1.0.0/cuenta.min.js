import{f as e}from"./utils-BAeLe99y.js";void 0===window.StorageUtils&&console.error("Error: storageUtils.js no está cargado");const t='\n    <ul class="skeleton-items">\n        <li class="skeleton skeleton-item"></li>\n        <li class="skeleton skeleton-item"></li>\n        <li class="skeleton skeleton-item"></li>\n    </ul>';async function n(){const e=await(window.StorageUtils?.getFavoritos())??[],t=await(window.StorageUtils?.getComparativas())??[],n=document.getElementById("favoritosCount");n&&(n.textContent=e.length);const o=document.getElementById("comparacionesCount");o&&(o.textContent=t.length)}async function o(){const t=document.getElementById("favoritos-items-container");if(!t)return void console.error("No se encontró el contenedor de favoritos");const o=await(window.StorageUtils?.getFavoritos())??[];if(!o.length)return void(t.innerHTML='\n            <div class="no-items">\n                <span class="empty-icon" aria-hidden="true">📦</span>\n                <p>No hay ítems guardados aún.</p>\n                <p>Guarda ítems desde la página de detalles para verlos aquí.</p>\n            </div>');const a=document.createElement("ul");a.className="favoritos-list",o.forEach((o,i)=>{const s=document.createElement("li");s.className="favorito-item",s.dataset.id=o.id;const r=document.createElement("img");r.className="favorito-icon",r.src="img/sphere_5528251.svg",r.alt="icono",r.width=24,r.height=24;const c=document.createElement("a");c.href=`/item?id=${o.id}`,c.className="favorito-link",o.nombre?c.textContent=o.nombre:c.innerHTML='<div class="skeleton skeleton-block"></div>',e(`https://api.guildwars2.com/v2/items/${o.id}?lang=es`).then(e=>e.ok?e.json():null).then(e=>{e&&(e.icon&&(r.src=e.icon),e.name&&(c.textContent=e.name))}).catch(e=>console.error("Error fetching item detalles:",e));const l=document.createElement("span");l.className="favorito-id",l.textContent=`#${o.id}`;const d=document.createElement("button");d.className="delete-favorito",d.title="Eliminar de favoritos",d.innerHTML="&times;",d.onclick=async e=>{e.preventDefault(),e.stopPropagation(),confirm(`¿Eliminar "${o.nombre||"este ítem"}" de favoritos?`)&&(window.StorageUtils&&window.StorageUtils.removeFavorito&&await window.StorageUtils.removeFavorito(o.id),s.remove(),0===document.querySelectorAll(".favorito-item").length&&(t.innerHTML='\n                        <div class="no-items">\n                            <span class="empty-icon" aria-hidden="true">📦</span>\n                            <p>No hay ítems guardados.</p>\n                        </div>'),window.StorageUtils?.showToast("Ítem eliminado de favoritos"),n())};const m=document.createElement("div");m.className="favorito-content",m.appendChild(r),m.appendChild(c),m.appendChild(l),s.appendChild(m),s.appendChild(d),a.appendChild(s)}),t.innerHTML="",t.appendChild(a);const i=document.createElement("div");i.className="favoritos-counter",i.textContent=`${o.length} ${1===o.length?"ítem":"ítems"} guardados`,t.prepend(i),n()}async function a(){const e=document.getElementById("lista-comparaciones");if(!e)return void console.error("No se encontró el contenedor de comparativas");const t=await(window.StorageUtils?.getComparativas())??[];if(!t.length)return void(e.innerHTML='\n            <div class="no-items">\n                <span class="empty-icon" aria-hidden="true">📦</span>\n                <p>No hay comparativas guardadas.</p>\n                <p>Guarda una comparativa desde la sección de comparativa para verla aquí.</p>\n            </div>');const o=document.createElement("ul");o.className="favoritos-list",t.forEach((t,a)=>{const i=document.createElement("li");i.className="favorito-item comparativa-item";const s=document.createElement("span");s.className="favorito-icon",s.innerHTML="📊";const r=Array.isArray(t.nombres)&&t.nombres.length?t.nombres.join(" vs "):`Comparativa ${a+1}`,c=document.createElement("a");c.href=`/compare-craft?ids=${t.ids.join(",")}`,c.className="favorito-link",c.textContent=r;const l=document.createElement("span");l.className="favorito-id";const d=t.ids.length;l.textContent=`(${d} ${1===d?"ítem":"ítems"})`;const m=document.createElement("button");m.className="delete-favorito",m.title="Eliminar comparativa",m.innerHTML="&times;",m.onclick=async o=>{o.preventDefault(),o.stopPropagation(),confirm("¿Eliminar esta comparativa?")&&(window.StorageUtils&&window.StorageUtils.removeComparativa&&await window.StorageUtils.removeComparativa(t.id),i.remove(),0===document.querySelectorAll(".comparativa-item").length&&(e.innerHTML="<p>No hay comparativas guardadas.</p>"),window.StorageUtils?.showToast("Comparativa eliminada"),n())};const p=document.createElement("div");p.className="favorito-content",p.appendChild(s),p.appendChild(c),p.appendChild(l),i.appendChild(p),i.appendChild(m),o.appendChild(i)}),e.innerHTML="",e.appendChild(o)}document.addEventListener("DOMContentLoaded",async function(){!function(){const e=document.getElementById("account-skeleton"),t=document.querySelector("main");e&&(e.style.display="block"),t&&(t.style.display="none")}();try{const i=await e("backend/api/user.php");if(!i.ok)return void(window.location.href="/login");const s=await i.json(),r=document.querySelector(".videos-board-topic");r&&(r.textContent=`Hola ${s.name||"Usuario"}`);const c=document.querySelector(".welcome-illustration img");c&&s.avatar&&(c.src=s.avatar,c.alt=`Avatar de ${s.name||"usuario"}`);const l=document.getElementById("refreshFavoritos");l&&l.addEventListener("click",function(){const e=document.getElementById("favoritos-items-container");e&&(e.innerHTML=t,setTimeout(o,300))});const d=document.getElementById("refreshComparativas");d&&d.addEventListener("click",function(){const e=document.getElementById("lista-comparaciones");e&&(e.innerHTML=t,setTimeout(a,300))}),await Promise.all([o(),a()]),await n()}catch(e){console.error("Error al cargar la cuenta:",e);const t=document.querySelector("main");t&&(t.innerHTML='\n                <div class="api-error">\n                    <p>Ocurrió un problema al cargar tu cuenta. Intenta de nuevo más tarde.</p>\n                </div>')}finally{!function(){const e=document.getElementById("account-skeleton"),t=document.querySelector("main");e&&(e.style.display="none"),t&&(t.style.display="")}()}});
//# sourceMappingURL=cuenta.min.v1.0.0.js.map
