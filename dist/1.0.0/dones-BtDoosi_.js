import{showSkeleton as e,hideSkeleton as n}from"./ui-helpers.min.js";import{restoreCraftIngredientPrototypes as t}from"./items-core.BW40sqiC.min.js";import"./utils-BAeLe99y.js";var o=[{id:19673,name:"Don de la Magia",mainIngredients:[{id:19675,name:"Trébol místico",type:"account_bound",count:77,components:[{id:19976,name:"Moneda mística",count:250},{id:19721,name:"Pegote de ectoplasma",count:250},{id:19925,name:"Esquirla de obsidiana",count:250},{id:20796,name:"Piedra filosofal",count:1500}]},{id:19721,name:"Pegote de ectoplasma",count:250}],manualIngredients:[{id:24295,name:"Vial de sangre poderosa",count:250},{id:24283,name:"Vesícula de veneno poderoso",count:250},{id:24300,name:"Tótem elaborado",count:250},{id:24277,name:"Montón de polvo cristalino",count:250}]},{id:19672,name:"Don del Poder",manualIngredients:[{id:24357,name:"Colmillo feroz",count:250},{id:24289,name:"Escama blindada",count:250},{id:24351,name:"Garra despiadada",count:250},{id:24358,name:"Hueso antiguo",count:250}]},{id:19626,name:"Don de la Suerte",mainIngredients:[{id:19721,name:"Pegote de ectoplasma",count:250},{id:19675,name:"Trébol místico",type:"account_bound",count:77,components:[{id:19976,name:"Moneda mística",count:250},{id:19721,name:"Pegote de ectoplasma",count:250},{id:19925,name:"Esquirla de obsidiana",count:250},{id:20796,name:"Piedra filosofal",count:1500}]},{id:19673,name:"Don de la Magia",type:"crafting_material",count:1,components:[{id:24295,name:"Vial de sangre poderosa",count:250},{id:24283,name:"Vesícula de veneno poderoso",count:250},{id:24300,name:"Tótem elaborado",count:250},{id:24277,name:"Montón de polvo cristalino",count:250}]},{id:19672,name:"Don del Poder",type:"crafting_material",count:1,components:[{id:24351,name:"Colmillo feroz",count:250},{id:24289,name:"Escama blindada",count:250},{id:24357,name:"Garra despiadada",count:250},{id:24358,name:"Hueso antiguo",count:250}]}]}];let a,d;function i(){document.getElementById("dones-content"),a=document.getElementById("dones-skeleton"),d=document.getElementById("error-message"),window.showSkeleton=e,window.hideSkeleton=n,window.DonesPages={loadSpecialDons:g,loadTributo:b,loadDraconicTribute:f,loadDones1Gen:v}}let r=null,s=null;async function l(e){const{ingredientTree:n}=await(o=e,r||(r=new Worker(new URL("./workers/donesWorker.js",import.meta.url),{type:"module"})),new Promise((e,n)=>{const t=n=>{r.removeEventListener("message",t),r.removeEventListener("error",a),e(n.data)},a=e=>{r.removeEventListener("message",t),r.removeEventListener("error",a),d.innerText=`Error del Worker: ${e.message||"Fallo inesperado."}`,d.style.display="block";try{r.terminate()}catch{}r=null,n(e)};r.addEventListener("message",t),r.addEventListener("error",a),r.postMessage({rootIngredients:o})}));var o;const{updatedTree:a,totals:i}=await function(e,n){return s||(s=new Worker(new URL("./workers/costsWorker.js",import.meta.url),{type:"module"})),new Promise((t,o)=>{const a=e=>{s.removeEventListener("message",a),s.removeEventListener("error",i),t(e.data)},i=e=>{s.removeEventListener("message",a),s.removeEventListener("error",i),d.innerText=`Error del Worker: ${e.message||"Fallo inesperado."}`,d.style.display="block";try{s.terminate()}catch{}s=null,o(e)};s.addEventListener("message",a),s.addEventListener("error",i),s.postMessage({ingredientTree:e,globalQty:n})})}(n,1);return t(a,null),{tree:a,totals:i}}function c(e,n=0){const t=n>0?`padding-left:${32*n}px;`:"",o=e.buy_price?formatGoldColored(e.buy_price):"-",a=e.sell_price?formatGoldColored(e.sell_price):"-",d=e.total_buy?formatGoldColored(e.total_buy):"-",i=e.total_sell?formatGoldColored(e.total_sell):"-";let r=`<tr>\n    <td style='${t}'>${e.icon?`<img src='${e.icon}' style='height:28px;'>`:"-"}</td>\n    <td>${e.name}</td>\n    <td>${Math.round(e.count)}</td>\n    <td>${o}</td>\n    <td>${a}</td>\n    <td>${d}</td>\n    <td>${i}</td>\n  </tr>`;if(Array.isArray(e.children))for(const t of e.children)r+=c(t,n+1);return r}async function m(e,n){const{fetchItemData:t,fetchPriceData:o}=window.DonesCore||{};if("function"!=typeof t)return d.innerText="Dependencia faltante: fetchItemData.",void(d.style.display="block");const a=n||document.getElementById("dones-content");a.innerHTML="",d.style.display="none";try{let n=e.name,o=null;if(e.id<9e4){const a=await t(e.id);n=a.name,o=a.icon}else{const n=e.manualIngredients[0];o=(await t(n.id)).icon}let d="";const i=e.name?e.name.toLowerCase():"",r=i.includes("suerte")||i.includes("magia")||i.includes("poder");if(r){if(e.mainIngredients&&e.mainIngredients.length>0){d+="<table class='table-modern-dones tabla-tarjetas'>\n          <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>";let n=0,t=0;for(const o of e.mainIngredients){const e=await E(o,0);d+=e.html,n+=e.totalBuy||0,t+=e.totalSell||0}d+="</tbody></table>",(n>0||t>0)&&(d+=`<div class='table-modern-totales' style='margin-bottom:50px;'>\n            <div class='precio-totales-dones'>\n              <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(n)}</div>\n              <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(t)}</div>\n            </div>\n          </div>`)}return void(a.innerHTML+=d)}if(r||(d+=`<h2 style='margin-top:18px;'><img src='${o}' style='height:32px;vertical-align:middle;'> ${n}</h2>`),e.mainIngredients&&e.mainIngredients.length>0){d+="<table class='table-modern-dones tabla-tarjetas'>\n        <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>";let n=0,t=0;for(const o of e.mainIngredients){const e=await E(o,0);d+=e.html,n+=e.totalBuy||0,t+=e.totalSell||0}d+="</tbody></table>",(n>0||t>0)&&(d+=`<div class='table-modern-totales' style='margin-bottom:50px;'>\n          <div class='precio-totales-dones'>\n            <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(n)}</div>\n            <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(t)}</div>\n          </div>\n        </div>`)}if(r)return;a.innerHTML+=d}catch(e){d.innerText=e.message,d.style.display="block"}}async function u(){const t=document.getElementById("dones-1ra-gen-content"),o=document.getElementById("dones-1ra-gen-skeleton");if(t&&o){e(o),t.innerHTML="";try{const a=await async function(){const{LEGENDARY_ITEMS:e}=window.LegendaryData||{},n=[],t=new Set;for(const o of Object.values(e)){if(!o.components)continue;const e=o.components.find(e=>{if(!e.name)return!1;const n=e.name.toLowerCase();return n.startsWith("don de")&&!n.includes("la suerte")&&!n.includes("del dominio")});e&&!t.has(e.id)&&(t.add(e.id),n.push({id:e.id,name:e.name,mainIngredients:e.components||[],manualIngredients:[]}))}return n.sort((e,n)=>e.name.localeCompare(n.name,"es")),n}(),d=document.createElement("div");d.className="don1gen-nav-btns",d.style="margin-bottom: 10%; display: flex; flex-wrap: wrap; gap: 10px;";const i=document.createElement("div");i.id="don1gen-result",a.forEach(t=>{const a=document.createElement("button");a.className="dones-btn",a.textContent=t.name,a.addEventListener("click",async()=>{d.querySelectorAll("button").forEach(e=>e.classList.remove("active")),a.classList.add("active"),i.innerHTML="",e(o),await m(t,i),n(o)}),d.appendChild(a)}),t.appendChild(d),t.appendChild(i)}catch(e){console.error("Error al renderizar dones de 1ra Gen:",e),t.innerHTML='<div class="error-message">Error al cargar los dones.</div>'}finally{n(o)}}}async function p(){const t=document.getElementById("tributo-draconico-content"),o=document.getElementById("tributo-draconico-skeleton");if(t&&o){e(o),t.innerHTML="";try{const e=await async function(){const{LEGENDARY_ITEMS_3GEN:e}=window.LegendaryData||{};for(const n of Object.values(e)){const e=n.components?.find(e=>(e.name?.toLowerCase()||"").includes("tributo dracónico"));if(e)return e}throw new Error("No se encontró el Tributo Dracónico en legendaryItems3gen")}();let n=`<h2>${e.name}</h2>`;n+="<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>";let o=0,a=0;for(const t of e.components){const e=await E(t,0);n+=e.html,o+=e.totalBuy||0,a+=e.totalSell||0}n+="</tbody></table>",n+=`<div class='table-modern-totales' style='margin-bottom:50px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(o)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(a)}</div>\n      </div>\n    </div>`,t.innerHTML=n}catch(e){console.error("Error al renderizar Tributo Dracónico:",e),t.innerHTML='<div class="error-message">Error al cargar el Tributo Dracónico.</div>'}finally{n(o)}}}const h={special:!1,tributo:!1,draco:!1,gen1:!1};async function g(){h.special||(h.special=!0,await async function(){const t=document.getElementById("dones-content"),d=a;e(d),t.innerHTML="";const i=o.filter(e=>e.name&&e.name.toLowerCase().includes("suerte"));for(const e of i){const n=document.createElement("div");t.appendChild(n),await m(e,n)}n(d)}())}async function b(){h.tributo||(h.tributo=!0,await async function(){const t=document.getElementById("tributo-content"),o=document.getElementById("tributo-skeleton");if(!t||!o)return;e(o),t.innerHTML="";try{const e=function(){const e={id:"TRIBUTO_MISTICO_ROOT",name:y.name,count:1,components:[]};return y.mainIngredients.forEach(n=>{e.components.push({...n})}),y.dons.forEach(n=>{const t=n.name.toLowerCase().includes("magia condensada")||n.name.toLowerCase().includes("poder condensado")?2:1,o={id:n.name.replace(/\s+/g,"_").toUpperCase(),name:n.name,count:t,components:[]};n.subdons.forEach(e=>{const n={id:e.name.replace(/\s+/g,"_").toUpperCase(),name:e.name,count:1,components:[]};e.ingredients.forEach(e=>{n.components.push({...e})}),o.components.push(n)}),e.components.push(o)}),e}();let n=`<h2>${e.name}</h2>`;n+="<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>";let o=0,a=0;for(const t of e.components){const e=await E(t,0);n+=e.html,o+=e.totalBuy||0,a+=e.totalSell||0}n+="</tbody></table>",n+=`<div class='table-modern-totales' style='margin-bottom:18px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(o)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(a)}</div>\n      </div>\n    </div>`,t.innerHTML=n}catch(e){console.error("Error al renderizar Tributo Místico:",e),t.innerHTML='<div class="error-message">Error al cargar el Tributo Místico.</div>'}finally{n(o)}}())}async function f(){h.draco||(h.draco=!0,await p())}async function v(){h.gen1||(h.gen1=!0,await u())}const y={name:"Tributo Místico",mainIngredients:[{id:19675,name:"Trébol místico",type:"account_bound",count:77,components:[{id:19976,name:"Moneda mística",count:250},{id:19721,name:"Pegote de ectoplasma",count:250},{id:19925,name:"Esquirla de obsidiana",count:250},{id:20796,name:"Piedra filosofal",count:1500}]},{id:19976,name:"Moneda mística",count:250}],dons:[{name:"Don de magia condensada",subdons:[{name:"Don de sangre",ingredients:[{id:24295,name:"Vial de sangre poderosa",count:100},{id:24294,name:"Vial de sangre potente",count:250},{id:24293,name:"Vial de sangre espesa",count:50},{id:24292,name:"Vial de sangre",count:50}]},{name:"Don de veneno",ingredients:[{id:24283,name:"Vesícula de veneno poderoso",count:100},{id:24282,name:"Vesícula de veneno potente",count:250},{id:24281,name:"Vesícula de veneno llena",count:50},{id:24280,name:"Vesícula de veneno",count:50}]},{name:"Don de tótems",ingredients:[{id:24300,name:"Tótem elaborado",count:100},{id:24299,name:"Tótem intrincado",count:250},{id:24298,name:"Tótem grabado",count:50},{id:24297,name:"Tótem",count:50}]},{name:"Don de polvo",ingredients:[{id:24277,name:"Montón de polvo cristalino",count:100},{id:24276,name:"Montón de polvo incandescente",count:250},{id:24275,name:"Montón de polvo luminoso",count:50},{id:24274,name:"Montón de polvo radiante",count:50}]}]},{name:"Don de poder condensado",subdons:[{name:"Don de garras",ingredients:[{id:24351,name:"Garra despiadada",count:100},{id:24350,name:"Garra grande",count:250},{id:24349,name:"Garra afilada",count:50},{id:24348,name:"Garra",count:50}]},{name:"Don de escamas",ingredients:[{id:24289,name:"Escama blindada",count:100},{id:24288,name:"Escama grande",count:250},{id:24287,name:"Escama suave",count:50},{id:24286,name:"Escama",count:50}]},{name:"Don de huesos",ingredients:[{id:24358,name:"Hueso antiguo",count:100},{id:24341,name:"Hueso grande",count:250},{id:24345,name:"Hueso pesado",count:50},{id:24344,name:"Hueso",count:50}]},{name:"Don de colmillos",ingredients:[{id:24357,name:"Colmillo feroz",count:100},{id:24356,name:"Colmillo grande",count:250},{id:24355,name:"Colmillo afilado",count:50},{id:24354,name:"Colmillo",count:50}]}]}]};async function E(e,n=0){const{tree:t}=await l([e]),o=t[0];return{html:c(o,n),totalBuy:o.total_buy||0,totalSell:o.total_sell||0}}export{i as init};
//# sourceMappingURL=dones-BtDoosi_.v1.0.0.js.map
