import{e}from"./utils-BAeLe99y.js";self.onmessage=async t=>{const{mainItemId:n}=t.data;try{const t=await async function(t){const n=await e(`/recipe-tree/${t}`).then(e=>e.json());if(!n||!n.components||0===n.components.length)return[];const i=new Set;!function e(t){t&&(i.add(t.id),t.components&&t.components.forEach(t=>{"Recipe"===t.type?e(t):"Item"===t.type&&i.add(t.id)}))}(n);const r=new Map,c=Array.from(i);for(let t=0;t<c.length;t+=200){const n=c.slice(t,t+200);(await e(`https://api.guildwars2.com/v2/items?ids=${n.join(",")}&lang=es`).then(e=>e.json())).forEach(e=>r.set(e.id,e))}const s=new Map;try{const t=`https://api.datawars2.ie/gw2/v1/items/csv?fields=id,buy_price,sell_price&ids=${Array.from(i).join(",")}`,n=await e(t).then(e=>e.text()),[r,...c]=n.trim().split("\n").map(e=>e.split(","));if(r&&r.length>0)for(const e of c){const t={};r.forEach((n,i)=>{const r=e[i];t[n]="id"===n?parseInt(r,10):"buy_price"===n||"sell_price"===n?""!==r&&void 0!==r?parseInt(r,10):null:r}),t.id&&s.set(t.id,t)}}catch(e){}const l=Array.from(i).filter(e=>!s.has(e));for(let t=0;t<l.length;t+=200){const n=l.slice(t,t+200);try{(await e(`https://api.guildwars2.com/v2/commerce/prices?ids=${n.join(",")}`).then(e=>e.json())).forEach(e=>{s.set(e.id,{id:e.id,buy_price:e.buys?.unit_price??null,sell_price:e.sells?.unit_price??null})})}catch(e){}}function o(e,t=null){const n=r.get(e.id);if(!n)return null;const i=s.get(e.id)||{},c=Array.isArray(e.components)&&e.components.length>0;let l=[];return c&&(l=e.components.map(e=>{if("Recipe"===e.type)return o(e,n.id);if("Item"===e.type){const t=r.get(e.id);if(!t)return null;const i=s.get(e.id)||{};return{id:t.id,name:t.name,icon:t.icon,rarity:t.rarity,count:e.quantity,buy_price:i.buy_price??null,sell_price:i.sell_price??null,crafted_price:null,is_craftable:!1,recipe:null,children:[],_parentId:n.id}}return null}).filter(Boolean)),{id:n.id,name:n.name,icon:n.icon,rarity:n.rarity,count:e.quantity,buy_price:i.buy_price??null,sell_price:i.sell_price??null,crafted_price:null,is_craftable:c,recipe:e.recipe||null,children:l,_parentId:t}}const a=o(n,null);return a&&a.children||[]}(n);self.postMessage({tree:t})}catch(e){self.postMessage({error:e.message})}};
//# sourceMappingURL=ingredientTreeWorker.lDCMzisp.v1.0.0.js.map
