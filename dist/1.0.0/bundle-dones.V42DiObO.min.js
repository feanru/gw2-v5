import{showSkeleton as e,hideSkeleton as n}from"./ui-helpers.min.js";import{restoreCraftIngredientPrototypes as t}from"./items-core.DbLmvs0P.min.js";import{f as o}from"./utils-BAeLe99y.js";const{fetchItemData:a,fetchPriceData:i}=window.DonesCore||{};var s=[{id:19673,name:"Don de la Magia",mainIngredients:[{id:19675,name:"Trébol místico",type:"account_bound",count:77,components:[{id:19976,name:"Moneda mística",count:250},{id:19721,name:"Pegote de ectoplasma",count:250},{id:19925,name:"Esquirla de obsidiana",count:250},{id:20796,name:"Piedra filosofal",count:1500}]},{id:19721,name:"Pegote de ectoplasma",count:250}],manualIngredients:[{id:24295,name:"Vial de sangre poderosa",count:250},{id:24283,name:"Vesícula de veneno poderoso",count:250},{id:24300,name:"Tótem elaborado",count:250},{id:24277,name:"Montón de polvo cristalino",count:250}]},{id:19672,name:"Don del Poder",manualIngredients:[{id:24357,name:"Colmillo feroz",count:250},{id:24289,name:"Escama blindada",count:250},{id:24351,name:"Garra despiadada",count:250},{id:24358,name:"Hueso antiguo",count:250}]},{id:19626,name:"Don de la Suerte",mainIngredients:[{id:19721,name:"Pegote de ectoplasma",count:250},{id:19675,name:"Trébol místico",type:"account_bound",count:77,components:[{id:19976,name:"Moneda mística",count:250},{id:19721,name:"Pegote de ectoplasma",count:250},{id:19925,name:"Esquirla de obsidiana",count:250},{id:20796,name:"Piedra filosofal",count:1500}]},{id:19673,name:"Don de la Magia",type:"crafting_material",count:1,components:[{id:24295,name:"Vial de sangre poderosa",count:250},{id:24283,name:"Vesícula de veneno poderoso",count:250},{id:24300,name:"Tótem elaborado",count:250},{id:24277,name:"Montón de polvo cristalino",count:250}]},{id:19672,name:"Don del Poder",type:"crafting_material",count:1,components:[{id:24351,name:"Colmillo feroz",count:250},{id:24289,name:"Escama blindada",count:250},{id:24357,name:"Garra despiadada",count:250},{id:24358,name:"Hueso antiguo",count:250}]}]}];document.getElementById("dones-content");const d=document.getElementById("dones-skeleton"),r=document.getElementById("error-message");window.showSkeleton=e,window.hideSkeleton=n;let c=null,l=null;async function m(e){const{ingredientTree:n}=await(o=e,c||(c=new Worker(new URL("./workers/donesWorker.js",import.meta.url),{type:"module"})),new Promise((e,n)=>{const t=n=>{c.removeEventListener("message",t),c.removeEventListener("error",a),e(n.data)},a=e=>{c.removeEventListener("message",t),c.removeEventListener("error",a),r.innerText=`Error del Worker: ${e.message||"Fallo inesperado."}`,r.style.display="block";try{c.terminate()}catch{}c=null,n(e)};c.addEventListener("message",t),c.addEventListener("error",a),c.postMessage({rootIngredients:o})}));var o;const{updatedTree:a,totals:i}=await function(e,n){if(!l){const e="undefined"!=typeof window&&window.COSTS_WORKER_HASH?`/dist/${window.__APP_VERSION__}/costsWorker.${window.COSTS_WORKER_HASH}.js?v=${window.__APP_VERSION__}`:new URL("./workers/costsWorker.js",import.meta.url);l=new Worker(e,{type:"module"})}return new Promise((t,o)=>{const a=e=>{l.removeEventListener("message",a),l.removeEventListener("error",i),t(e.data)},i=e=>{l.removeEventListener("message",a),l.removeEventListener("error",i),r.innerText=`Error del Worker: ${e.message||"Fallo inesperado."}`,r.style.display="block";try{l.terminate()}catch{}l=null,o(e)};l.addEventListener("message",a),l.addEventListener("error",i),l.postMessage({ingredientTree:e,globalQty:n})})}(n,1);return t(a,null),{tree:a,totals:i}}function u(e,n=0){const t=n>0?`padding-left:${32*n}px;`:"",o=e.buy_price?formatGoldColored(e.buy_price):"-",a=e.sell_price?formatGoldColored(e.sell_price):"-",i=e.total_buy?formatGoldColored(e.total_buy):"-",s=e.total_sell?formatGoldColored(e.total_sell):"-";let d=`<tr>\n    <td style='${t}'>${e.icon?`<img src='${e.icon}' style='height:28px;'>`:"-"}</td>\n    <td>${e.name}</td>\n    <td>${Math.round(e.count)}</td>\n    <td>${o}</td>\n    <td>${a}</td>\n    <td>${i}</td>\n    <td>${s}</td>\n  </tr>`;if(Array.isArray(e.children))for(const t of e.children)d+=u(t,n+1);return d}async function p(e,n){const t=n||document.getElementById("dones-content");t.innerHTML="",r.style.display="none";try{let n=e.name,o=null;if(e.id<9e4){const t=await a(e.id);n=t.name,o=t.icon}else{const n=e.manualIngredients[0];o=(await a(n.id)).icon}let i="";const s=e.name?e.name.toLowerCase():"",d=s.includes("suerte")||s.includes("magia")||s.includes("poder");if(d){if(e.mainIngredients&&e.mainIngredients.length>0){i+="<table class='table-modern-dones tabla-tarjetas'>\n          <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>";let n=0,t=0;for(const o of e.mainIngredients){const e=await v(o,0);i+=e.html,n+=e.totalBuy||0,t+=e.totalSell||0}i+="</tbody></table>",(n>0||t>0)&&(i+=`<div class='table-modern-totales' style='margin-bottom:50px;'>\n            <div class='precio-totales-dones'>\n              <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(n)}</div>\n              <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(t)}</div>\n            </div>\n          </div>`)}return void(t.innerHTML+=i)}if(d||(i+=`<h2 style='margin-top:18px;'><img src='${o}' style='height:32px;vertical-align:middle;'> ${n}</h2>`),e.mainIngredients&&e.mainIngredients.length>0){i+="<table class='table-modern-dones tabla-tarjetas'>\n        <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>";let n=0,t=0;for(const o of e.mainIngredients){const e=await v(o,0);i+=e.html,n+=e.totalBuy||0,t+=e.totalSell||0}i+="</tbody></table>",(n>0||t>0)&&(i+=`<div class='table-modern-totales' style='margin-bottom:50px;'>\n          <div class='precio-totales-dones'>\n            <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(n)}</div>\n            <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(t)}</div>\n          </div>\n        </div>`)}if(d)return;t.innerHTML+=i}catch(e){r.innerText=e.message,r.style.display="block"}}async function g(){const t=document.getElementById("dones-1ra-gen-content"),o=document.getElementById("dones-1ra-gen-skeleton");if(t&&o){e(o),t.innerHTML="";try{const a=await async function(){const{LEGENDARY_ITEMS:e}=window.LegendaryData||{},n=[],t=new Set;for(const o of Object.values(e)){if(!o.components)continue;const e=o.components.find(e=>{if(!e.name)return!1;const n=e.name.toLowerCase();return n.startsWith("don de")&&!n.includes("la suerte")&&!n.includes("del dominio")});e&&!t.has(e.id)&&(t.add(e.id),n.push({id:e.id,name:e.name,mainIngredients:e.components||[],manualIngredients:[]}))}return n.sort((e,n)=>e.name.localeCompare(n.name,"es")),n}(),i=document.createElement("div");i.className="don1gen-nav-btns",i.style="margin-bottom: 10%; display: flex; flex-wrap: wrap; gap: 10px;";const s=document.createElement("div");s.id="don1gen-result",a.forEach(t=>{const a=document.createElement("button");a.className="dones-btn",a.textContent=t.name,a.addEventListener("click",async()=>{i.querySelectorAll("button").forEach(e=>e.classList.remove("active")),a.classList.add("active"),s.innerHTML="",e(o),await p(t,s),n(o)}),i.appendChild(a)}),t.appendChild(i),t.appendChild(s)}catch(e){console.error("Error al renderizar dones de 1ra Gen:",e),t.innerHTML='<div class="error-message">Error al cargar los dones.</div>'}finally{n(o)}}}async function h(){const t=document.getElementById("tributo-draconico-content"),o=document.getElementById("tributo-draconico-skeleton");if(t&&o){e(o),t.innerHTML="";try{const e=await async function(){const{LEGENDARY_ITEMS_3GEN:e}=window.LegendaryData||{};for(const n of Object.values(e)){const e=n.components?.find(e=>(e.name?.toLowerCase()||"").includes("tributo dracónico"));if(e)return e}throw new Error("No se encontró el Tributo Dracónico en legendaryItems3gen")}();let n=`<h2>${e.name}</h2>`;n+="<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>";let o=0,a=0;for(const t of e.components){const e=await v(t,0);n+=e.html,o+=e.totalBuy||0,a+=e.totalSell||0}n+="</tbody></table>",n+=`<div class='table-modern-totales' style='margin-bottom:50px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(o)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(a)}</div>\n      </div>\n    </div>`,t.innerHTML=n}catch(e){console.error("Error al renderizar Tributo Dracónico:",e),t.innerHTML='<div class="error-message">Error al cargar el Tributo Dracónico.</div>'}finally{n(o)}}}const b={special:!1,tributo:!1,draco:!1,gen1:!1};window.DonesPages={loadSpecialDons:async function(){b.special||(b.special=!0,await async function(){const t=document.getElementById("dones-content"),o=d;e(o),t.innerHTML="";const a=s.filter(e=>e.name&&e.name.toLowerCase().includes("suerte"));for(const e of a){const n=document.createElement("div");t.appendChild(n),await p(e,n)}n(o)}())},loadTributo:async function(){b.tributo||(b.tributo=!0,await async function(){const t=document.getElementById("tributo-content"),o=document.getElementById("tributo-skeleton");if(!t||!o)return;e(o),t.innerHTML="";try{const e=function(){const e={id:"TRIBUTO_MISTICO_ROOT",name:f.name,count:1,components:[]};return f.mainIngredients.forEach(n=>{e.components.push({...n})}),f.dons.forEach(n=>{const t=n.name.toLowerCase().includes("magia condensada")||n.name.toLowerCase().includes("poder condensado")?2:1,o={id:n.name.replace(/\s+/g,"_").toUpperCase(),name:n.name,count:t,components:[]};n.subdons.forEach(e=>{const n={id:e.name.replace(/\s+/g,"_").toUpperCase(),name:e.name,count:1,components:[]};e.ingredients.forEach(e=>{n.components.push({...e})}),o.components.push(n)}),e.components.push(o)}),e}();let n=`<h2>${e.name}</h2>`;n+="<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>";let o=0,a=0;for(const t of e.components){const e=await v(t,0);n+=e.html,o+=e.totalBuy||0,a+=e.totalSell||0}n+="</tbody></table>",n+=`<div class='table-modern-totales' style='margin-bottom:18px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(o)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(a)}</div>\n      </div>\n    </div>`,t.innerHTML=n}catch(e){console.error("Error al renderizar Tributo Místico:",e),t.innerHTML='<div class="error-message">Error al cargar el Tributo Místico.</div>'}finally{n(o)}}())},loadDraconicTribute:async function(){b.draco||(b.draco=!0,await h())},loadDones1Gen:async function(){b.gen1||(b.gen1=!0,await g())}};const f={name:"Tributo Místico",mainIngredients:[{id:19675,name:"Trébol místico",type:"account_bound",count:77,components:[{id:19976,name:"Moneda mística",count:250},{id:19721,name:"Pegote de ectoplasma",count:250},{id:19925,name:"Esquirla de obsidiana",count:250},{id:20796,name:"Piedra filosofal",count:1500}]},{id:19976,name:"Moneda mística",count:250}],dons:[{name:"Don de magia condensada",subdons:[{name:"Don de sangre",ingredients:[{id:24295,name:"Vial de sangre poderosa",count:100},{id:24294,name:"Vial de sangre potente",count:250},{id:24293,name:"Vial de sangre espesa",count:50},{id:24292,name:"Vial de sangre",count:50}]},{name:"Don de veneno",ingredients:[{id:24283,name:"Vesícula de veneno poderoso",count:100},{id:24282,name:"Vesícula de veneno potente",count:250},{id:24281,name:"Vesícula de veneno llena",count:50},{id:24280,name:"Vesícula de veneno",count:50}]},{name:"Don de tótems",ingredients:[{id:24300,name:"Tótem elaborado",count:100},{id:24299,name:"Tótem intrincado",count:250},{id:24298,name:"Tótem grabado",count:50},{id:24297,name:"Tótem",count:50}]},{name:"Don de polvo",ingredients:[{id:24277,name:"Montón de polvo cristalino",count:100},{id:24276,name:"Montón de polvo incandescente",count:250},{id:24275,name:"Montón de polvo luminoso",count:50},{id:24274,name:"Montón de polvo radiante",count:50}]}]},{name:"Don de poder condensado",subdons:[{name:"Don de garras",ingredients:[{id:24351,name:"Garra despiadada",count:100},{id:24350,name:"Garra grande",count:250},{id:24349,name:"Garra afilada",count:50},{id:24348,name:"Garra",count:50}]},{name:"Don de escamas",ingredients:[{id:24289,name:"Escama blindada",count:100},{id:24288,name:"Escama grande",count:250},{id:24287,name:"Escama suave",count:50},{id:24286,name:"Escama",count:50}]},{name:"Don de huesos",ingredients:[{id:24358,name:"Hueso antiguo",count:100},{id:24341,name:"Hueso grande",count:250},{id:24345,name:"Hueso pesado",count:50},{id:24344,name:"Hueso",count:50}]},{name:"Don de colmillos",ingredients:[{id:24357,name:"Colmillo feroz",count:100},{id:24356,name:"Colmillo grande",count:250},{id:24355,name:"Colmillo afilado",count:50},{id:24354,name:"Colmillo",count:50}]}]}]};async function v(e,n=0){const{tree:t}=await m([e]),o=t[0];return{html:u(o,n),totalBuy:o.total_buy||0,totalSell:o.total_sell||0}}!function(){const e=new Map,n=new Map,t={19676:1e4},a=[19675,19925,20796,19665,19674,19626,19672,19673,19645,19650,19655,19639,19635,19621,20799],i=function(e){if(!e)return!1;const n=e.toLowerCase();return n.startsWith("don de ")||n.startsWith("don del ")||n.startsWith("don de la ")},s=function(e){return a.includes(e)},d=async function(n){if(e.has(n))return e.get(n);const t=sessionStorage.getItem("item:"+n);if(t){const o=JSON.parse(t);return e.set(n,o),o}const a=await o("https://api.guildwars2.com/v2/items/"+n);if(!a.ok)throw new Error("No se pudo obtener info de item "+n);const i=await a.json();e.set(n,i);try{sessionStorage.setItem("item:"+n,JSON.stringify(i))}catch(e){}return i},r=async function(e){if(void 0!==t[e]){const n=t[e];return{buys:{unit_price:n},sells:{unit_price:n}}}if(s(e))return null;if(n.has(e))return n.get(e);const a=sessionStorage.getItem("price:"+e);if(a){const t=JSON.parse(a);return n.set(e,t),t}const i=await o("https://api.guildwars2.com/v2/commerce/prices/"+e);if(!i.ok)return null;const d=await i.json();n.set(e,d);try{sessionStorage.setItem("price:"+e,JSON.stringify(d))}catch(e){}return d};"undefined"!=typeof window&&(window.DonesCore={fetchItemData:d,fetchPriceData:r,isGiftName:i,shouldSkipMarketCheck:s}),document.addEventListener("DOMContentLoaded",async function(){await import("./tabs.min.js");const e={};document.addEventListener("tabchange",n=>{var t;t=n.detail.tabId,localStorage.setItem("activeDonTab",t),!e[t]&&window.DonesPages&&(e[t]=!0,"tab-don-suerte"===t?window.DonesPages.loadSpecialDons():"tab-tributo-mistico"===t?window.DonesPages.loadTributo():"tab-tributo-draconico"===t?window.DonesPages.loadDraconicTribute():"dones-1ra-gen"===t&&window.DonesPages.loadDones1Gen())});const n=localStorage.getItem("activeDonTab"),t=n?document.querySelector(`.tab-button[data-tab="${n}"]`):document.querySelector(".tab-button[data-tab]");t&&t.click()})}();
//# sourceMappingURL=bundle-dones.V42DiObO.min.v1.0.0.js.map
