{"version":3,"file":"dones-2w1fx2zd.js","sources":["../../src/js/dones.js"],"sourcesContent":["import { showSkeleton, hideSkeleton } from './ui-helpers.js';\nimport { restoreCraftIngredientPrototypes } from './items-core.js';\n\n// Always obtain the latest core reference rather than using a stale destructure\nfunction getCore() { return window.DonesCore || {}; }\n// js/dones.js\n\n// Sección de \"Dones Especiales\" (ejemplo: Don de la Suerte)\n// Puedes agregar más dones en el array DONES si lo deseas\n\nvar DONES = [\n  {\n    id: 19673, // ID real para Don de la Magia\n    name: \"Don de la Magia\",\n    mainIngredients: [\n      { id: 19675, name: \"Trébol místico\", type: \"account_bound\", count: 77, components: [\n  { id: 19976, name: \"Moneda mística\", count: 250 },\n  { id: 19721, name: \"Pegote de ectoplasma\", count: 250 },\n  { id: 19925, name: \"Esquirla de obsidiana\", count: 250 },\n  { id: 20796, name: \"Piedra filosofal\", count: 1500 }\n]},\n      { id: 19721, name: \"Pegote de ectoplasma\", count: 250 }\n    ],\n    manualIngredients: [\n      { id: 24295, name: \"Vial de sangre poderosa\", count: 250 },\n      { id: 24283, name: \"Vesícula de veneno poderoso\", count: 250 },\n      { id: 24300, name: \"Tótem elaborado\", count: 250 },\n      { id: 24277, name: \"Montón de polvo cristalino\", count: 250 },\n    ]\n  },\n  {\n    id: 19672, // ID real para Don del Poder\n    name: \"Don del Poder\",\n    manualIngredients: [\n      { id: 24357, name: \"Colmillo feroz\", count: 250 },\n      { id: 24289, name: \"Escama blindada\", count: 250 },\n      { id: 24351, name: \"Garra despiadada\", count: 250 },\n      { id: 24358, name: \"Hueso antiguo\", count: 250 },\n    ]\n  },\n  {\n    id: 19626,\n    name: \"Don de la Suerte\",\n    mainIngredients: [\n      { id: 19721, name: \"Pegote de ectoplasma\", count: 250 },\n      {\n        id: 19675,\n        name: \"Trébol místico\",\n        type: \"account_bound\",\n        count: 77,\n        components: [\n          { id: 19976, name: \"Moneda mística\", count: 250 },\n          { id: 19721, name: \"Pegote de ectoplasma\", count: 250 },\n          { id: 19925, name: \"Esquirla de obsidiana\", count: 250 },\n          { id: 20796, name: \"Piedra filosofal\", count: 1500 }\n        ]\n      },\n      {\n        id: 19673,\n        name: \"Don de la Magia\",\n        type: \"crafting_material\",\n        count: 1,\n        components: [\n          { id: 24295, name: \"Vial de sangre poderosa\", count: 250 },\n          { id: 24283, name: \"Vesícula de veneno poderoso\", count: 250 },\n          { id: 24300, name: \"Tótem elaborado\", count: 250 },\n          { id: 24277, name: \"Montón de polvo cristalino\", count: 250 }\n        ]\n      },\n      {\n        id: 19672,\n        name: \"Don del Poder\",\n        type: \"crafting_material\",\n        count: 1,\n        components: [\n          { id: 24351, name: \"Colmillo feroz\", count: 250 },\n          { id: 24289, name: \"Escama blindada\", count: 250 },\n          { id: 24357, name: \"Garra despiadada\", count: 250 },\n          { id: 24358, name: \"Hueso antiguo\", count: 250 }\n        ]\n      }\n    ]\n  }\n];\n\nconst API_ITEM = \"https://api.guildwars2.com/v2/items/\";\nconst API_PRICES = \"https://api.guildwars2.com/v2/commerce/prices/\";\n\nconst donesContent = document.getElementById('dones-content');\nconst donesSkeleton = document.getElementById('dones-skeleton');\nconst errorMsg = document.getElementById('error-message');\n\nwindow.showSkeleton = showSkeleton;\nwindow.hideSkeleton = hideSkeleton;\n\n\n// --- Fin de formatGold ---\n\n// IDs de ítems no comerciables o con precios especiales que deben saltarse\n// Items con precio fijo manual\nconst FIXED_PRICE_ITEMS = {\n  19676: 10000 // Piedra rúnica helada: 1 oro (10000 cobre)\n};\n\nconst EXCLUDED_ITEM_IDS = [\n  19675, // Trébol místico (account bound)\n  19925, // Esquirla de obsidiana (precio especial)\n  20796, // Piedra filosofal (precio especial)\n  20799, // Cristal místico (no comerciable)\n  19665, // Don del noble (account bound)\n  19674, // Don del dominio (account bound)\n  19626, // Don de la suerte (crafting, sin precio directo)\n  19672, // Don del poder\n  19673, // Don de la magia\n  19645, 19650, 19655, 19639, 19635, 19621 // Diversos \"Don de ...\" (account bound)\n];\nlet donesWorkerInstance = null;\nlet costsWorkerInstance = null;\n\nfunction runDonesWorker(rootIngredients) {\n  if (!donesWorkerInstance) {\n    donesWorkerInstance = new Worker(new URL('./workers/donesWorker.js', import.meta.url), { type: 'module' });\n  }\n  return new Promise((resolve, reject) => {\n    const handleMessage = (e) => {\n      donesWorkerInstance.removeEventListener('message', handleMessage);\n      donesWorkerInstance.removeEventListener('error', handleError);\n      resolve(e.data);\n    };\n    const handleError = (err) => {\n      donesWorkerInstance.removeEventListener('message', handleMessage);\n      donesWorkerInstance.removeEventListener('error', handleError);\n      // Show a clear message for worker failures\n      errorMsg.innerText = `Error del Worker: ${err.message || 'Fallo inesperado.'}`;\n      errorMsg.style.display = 'block';\n      // Reset the worker so future calls create a fresh instance\n      try {\n        donesWorkerInstance.terminate();\n      } catch {}\n      donesWorkerInstance = null;\n      reject(err);\n    };\n    donesWorkerInstance.addEventListener('message', handleMessage);\n    donesWorkerInstance.addEventListener('error', handleError);\n    donesWorkerInstance.postMessage({ rootIngredients });\n  });\n}\n\nfunction runCostsWorker(ingredientTree, globalQty) {\n  if (!costsWorkerInstance) {\n    costsWorkerInstance = new Worker(new URL('./workers/costsWorker.js', import.meta.url), { type: 'module' });\n  }\n  return new Promise((resolve, reject) => {\n    const handleMessage = (e) => {\n      costsWorkerInstance.removeEventListener('message', handleMessage);\n      costsWorkerInstance.removeEventListener('error', handleError);\n      resolve(e.data);\n    };\n    const handleError = (err) => {\n      costsWorkerInstance.removeEventListener('message', handleMessage);\n      costsWorkerInstance.removeEventListener('error', handleError);\n      // Provide feedback and reset the worker on errors\n      errorMsg.innerText = `Error del Worker: ${err.message || 'Fallo inesperado.'}`;\n      errorMsg.style.display = 'block';\n      try {\n        costsWorkerInstance.terminate();\n      } catch {}\n      costsWorkerInstance = null;\n      reject(err);\n    };\n    costsWorkerInstance.addEventListener('message', handleMessage);\n    costsWorkerInstance.addEventListener('error', handleError);\n    costsWorkerInstance.postMessage({ ingredientTree, globalQty });\n  });\n}\n\nasync function buildWorkerTree(ings) {\n  const { ingredientTree } = await runDonesWorker(ings);\n  const { updatedTree, totals } = await runCostsWorker(ingredientTree, 1);\n  restoreCraftIngredientPrototypes(updatedTree, null);\n  return { tree: updatedTree, totals };\n}\n\nfunction renderNodeHtml(node, level = 0) {\n  const indent = level > 0 ? `padding-left:${level * 32}px;` : '';\n  const priceBuy = node.buy_price ? formatGoldColored(node.buy_price) : '-';\n  const priceSell = node.sell_price ? formatGoldColored(node.sell_price) : '-';\n  const totalBuy = node.total_buy ? formatGoldColored(node.total_buy) : '-';\n  const totalSell = node.total_sell ? formatGoldColored(node.total_sell) : '-';\n  let rowHtml = `<tr>\n    <td style='${indent}'>${node.icon ? `<img src='${node.icon}' style='height:28px;'>` : '-'}</td>\n    <td>${node.name}</td>\n    <td>${Math.round(node.count)}</td>\n    <td>${priceBuy}</td>\n    <td>${priceSell}</td>\n    <td>${totalBuy}</td>\n    <td>${totalSell}</td>\n  </tr>`;\n  if (Array.isArray(node.children)) {\n    for (const child of node.children) {\n      rowHtml += renderNodeHtml(child, level + 1);\n    }\n  }\n  return rowHtml;\n}\n\n\nasync function renderDon(don, container) {\n  const { fetchItemData, fetchPriceData } = getCore();\n  if (typeof fetchItemData !== 'function') {\n    errorMsg.innerText = 'Dependencia faltante: fetchItemData.';\n    errorMsg.style.display = 'block';\n    return;\n  }\n  // Si no se pasa un contenedor, se usa el global por defecto (comportamiento antiguo)\n  const targetContainer = container || document.getElementById('dones-content');\n  targetContainer.innerHTML = ''; // Limpiamos el contenedor específico para este don\n  errorMsg.style.display = 'none';\n  // No limpiar donesContent aquí, para permitir varios dones en la página (limpiaremos solo una vez afuera)\n  try {\n    // Si el id es ficticio (mayor a 90000) NO pedir a la API el don principal\n    let donName = don.name;\n    let donIcon = null;\n    if (don.id < 90000) {\n      // ID real: obtener datos de la API\n      const donInfo = await fetchItemData(don.id);\n      donName = donInfo.name;\n      donIcon = donInfo.icon;\n    } else {\n      // ID ficticio: usar el ícono del primer ingrediente\n      const primerIng = don.manualIngredients[0];\n      const primerIngInfo = await fetchItemData(primerIng.id);\n      donIcon = primerIngInfo.icon;\n    }\n    // Renderizar mainIngredients en tabla separada si existen\n    let html = '';\n    // Para Don de la Suerte/Magia/Poder, SOLO una tabla anidada del árbol principal, sin encabezado ni títulos\n    const nombre = don.name ? don.name.toLowerCase() : '';\n    const esDonSimple = nombre.includes('suerte') || nombre.includes('magia') || nombre.includes('poder');\n    if (esDonSimple) {\n      if (don.mainIngredients && don.mainIngredients.length > 0) {\n        html += `<table class='table-modern-dones tabla-tarjetas'>\n          <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>`;\n        let totalBuy = 0;\n        let totalSell = 0;\n        for (const ing of don.mainIngredients) {\n          const result = await renderIngredientRowWithComponents(ing, 0);\n          html += result.html;\n          totalBuy += result.totalBuy || 0;\n          totalSell += result.totalSell || 0;\n        }\n        html += `</tbody></table>`;\n        if (totalBuy > 0 || totalSell > 0) {\n          html += `<div class='table-modern-totales' style='margin-bottom:50px;'>\n            <div class='precio-totales-dones'>\n              <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n              <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n            </div>\n          </div>`;\n        }\n      }\n      targetContainer.innerHTML += html;\n      return;\n    }\n    // Para otros dones, renderizado normal\n    if (!esDonSimple) {\n      html += `<h2 style='margin-top:18px;'><img src='${donIcon}' style='height:32px;vertical-align:middle;'> ${donName}</h2>`;\n    }\n    if (don.mainIngredients && don.mainIngredients.length > 0) {\n      html += `<table class='table-modern-dones tabla-tarjetas'>\n        <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>`;\n      \n      let totalBuy = 0;\n      let totalSell = 0;\n      \n      for (const ing of don.mainIngredients) {\n        const result = await renderIngredientRowWithComponents(ing, 0);\n        html += result.html;\n        totalBuy += result.totalBuy || 0;\n        totalSell += result.totalSell || 0;\n      }\n      \n      html += `</tbody></table>`;\n      \n      if (totalBuy > 0 || totalSell > 0) {\n        html += `<div class='table-modern-totales' style='margin-bottom:50px;'>\n          <div class='precio-totales-dones'>\n            <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n            <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n          </div>\n        </div>`;\n      }\n    }\n    // Para el Don de la Suerte, Don de la Magia y Don del Poder, NO renderizar tabla manualIngredients, solo el árbol completo\n    // Ya manejado arriba para esDonSimple\n    if (esDonSimple) return;\n    // El renderizado de ingredientes manuales ha sido eliminado completamente.\n    targetContainer.innerHTML += html;\n  } catch (e) {\n    errorMsg.innerText = e.message;\n    errorMsg.style.display = 'block';\n  }\n}\n\n// === Dones de armas legendarias Gen 1 ===\nasync function extractWeaponGifts() {\n  const { LEGENDARY_ITEMS } = window.LegendaryData || {};\n  const gifts = [];\n  const seen = new Set();\n  for (const item of Object.values(LEGENDARY_ITEMS)) {\n    if (!item.components) continue;\n    const gift = item.components.find(c => {\n      if (!c.name) return false;\n      const lower = c.name.toLowerCase();\n      return lower.startsWith('don de') && !lower.includes('la suerte') && !lower.includes('del dominio');\n    });\n    if (gift && !seen.has(gift.id)) {\n      seen.add(gift.id);\n      gifts.push({\n        id: gift.id,\n        name: gift.name,\n        mainIngredients: gift.components || [],\n        manualIngredients: []\n      });\n    }\n  }\n  // Orden alfabético por nombre\n  gifts.sort((a,b)=>a.name.localeCompare(b.name,'es'));\n  return gifts;\n}\n\n// Renderizar dones de armas legendarias de 1ra Gen\nasync function renderLegendaryWeaponGifts() {\n  const container = document.getElementById('dones-1ra-gen-content');\n  const skeleton = document.getElementById('dones-1ra-gen-skeleton');\n  if (!container || !skeleton) return;\n\n  showSkeleton(skeleton);\n  container.innerHTML = '';\n\n  try {\n    const gifts = await extractWeaponGifts();\n    const btnsDiv = document.createElement('div');\n    btnsDiv.className = 'don1gen-nav-btns';\n    btnsDiv.style = 'margin-bottom: 10%; display: flex; flex-wrap: wrap; gap: 10px;';\n\n    const resultDiv = document.createElement('div');\n    resultDiv.id = 'don1gen-result';\n\n    gifts.forEach((don) => {\n      const btn = document.createElement('button');\n      btn.className = 'dones-btn';\n      btn.textContent = don.name;\n      btn.addEventListener('click', async () => {\n        btnsDiv.querySelectorAll('button').forEach(b => b.classList.remove('active'));\n        btn.classList.add('active');\n        resultDiv.innerHTML = '';\n        showSkeleton(skeleton);\n        await renderDon(don, resultDiv);\n        hideSkeleton(skeleton);\n      });\n      btnsDiv.appendChild(btn);\n    });\n\n    container.appendChild(btnsDiv);\n    container.appendChild(resultDiv);\n  } catch (error) {\n    console.error('Error al renderizar dones de 1ra Gen:', error);\n    container.innerHTML = '<div class=\"error-message\">Error al cargar los dones.</div>';\n  } finally {\n    hideSkeleton(skeleton);\n  }\n}\n\n\n// Renderizar dones especiales (los que no son de armas)\nasync function renderSpecialDons() {\n  const container = document.getElementById('dones-content');\n  const skeleton = donesSkeleton;\n  showSkeleton(skeleton);\n  container.innerHTML = '';\n\n  // Renderizamos únicamente el Don de la Suerte (evitamos Magia y Poder para no duplicar tablas)\n  const specialDons = DONES.filter(d => d.name && d.name.toLowerCase().includes('suerte')); \n\n  for (const don of specialDons) {\n    const donContainer = document.createElement('div');\n    container.appendChild(donContainer);\n    await renderDon(don, donContainer);\n  }\n  hideSkeleton(skeleton);\n}\n\n// === Tributo Dracónico ===\nasync function getDraconicTribute() {\n  const { LEGENDARY_ITEMS_3GEN } = window.LegendaryData || {};\n  for (const weapon of Object.values(LEGENDARY_ITEMS_3GEN)) {\n    const tribute = weapon.components?.find(c => {\n      const nm = c.name?.toLowerCase() || '';\n      return nm.includes('tributo dracónico');\n    });\n    if (tribute) return tribute; // Es único, lo devolvemos\n  }\n  throw new Error('No se encontró el Tributo Dracónico en legendaryItems3gen');\n}\n\nasync function renderDraconicTribute() {\n  const container = document.getElementById('tributo-draconico-content');\n  const skeleton = document.getElementById('tributo-draconico-skeleton');\n  if (!container || !skeleton) return;\n\n  showSkeleton(skeleton);\n  container.innerHTML = '';\n\n  try {\n    const tributoTree = await getDraconicTribute();\n    let html = `<h2>${tributoTree.name}</h2>`;\n    html += `<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>`;\n\n    let totalBuy = 0;\n    let totalSell = 0;\n\n    // Renderizar cada componente de nivel superior del tributo\n    for (const component of tributoTree.components) {\n      const result = await renderIngredientRowWithComponents(component, 0);\n      html += result.html;\n      totalBuy += result.totalBuy || 0;\n      totalSell += result.totalSell || 0;\n    }\n\n    html += `</tbody></table>`;\n    html += `<div class='table-modern-totales' style='margin-bottom:50px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n      </div>\n    </div>`;\n\n    container.innerHTML = html;\n  } catch (e) {\n    console.error('Error al renderizar Tributo Dracónico:', e);\n    container.innerHTML = '<div class=\"error-message\">Error al cargar el Tributo Dracónico.</div>';\n  } finally {\n    hideSkeleton(skeleton);\n  }\n}\n\n// Exponer funciones de carga perezosa para cada pestaña\nconst _loadedTabs = {\n  special: false,\n  tributo: false,\n  draco: false,\n  gen1: false\n};\n\nasync function loadSpecialDons() {\n  if (_loadedTabs.special) return;\n  _loadedTabs.special = true;\n  await renderSpecialDons();\n}\n\nasync function loadTributo() {\n  if (_loadedTabs.tributo) return;\n  _loadedTabs.tributo = true;\n  await renderTributo();\n}\n\nasync function loadDraconicTribute() {\n  if (_loadedTabs.draco) return;\n  _loadedTabs.draco = true;\n  await renderDraconicTribute();\n}\n\nasync function loadDones1Gen() {\n  if (_loadedTabs.gen1) return;\n  _loadedTabs.gen1 = true;\n  await renderLegendaryWeaponGifts();\n}\n\nexport function init() {\n  window.DonesPages = {\n    loadSpecialDons,\n    loadTributo,\n    loadDraconicTribute,\n    loadDones1Gen\n  };\n}\n\n// === Tributo Dracónico ===\nasync function renderTributoDraconico() {\n  const container = document.getElementById('tributo-draconico-content');\n  const tributoDraconicoSkeleton = document.getElementById('tributo-draconico-skeleton');\n  if (!container || !tributoDraconicoSkeleton) return;\n  showSkeleton(tributoDraconicoSkeleton);\n  container.innerHTML = '';\n  errorMsg.style.display = 'none';\n  const { fetchItemData, fetchPriceData } = getCore();\n  if (typeof fetchItemData !== 'function' || typeof fetchPriceData !== 'function') {\n    errorMsg.innerText = 'Dependencias faltantes: fetchItemData y/o fetchPriceData.';\n    errorMsg.style.display = 'block';\n    hideSkeleton(tributoDraconicoSkeleton);\n    return;\n  }\n  try {\n    if (TRIBUTO_DRACONICO.mainIngredients && TRIBUTO_DRACONICO.mainIngredients.length > 0) {\n      let html = `<h3>Ingredientes principales</h3>`;\n      html += `<table class='table-modern-dones tabla-tarjetas'><thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead><tbody>`;\n      \n      // Variables para acumular totales\n      let totalBuy = 0;\n      let totalSell = 0;\n      let trebolBuy = 0;\n      let trebolSell = 0;\n      let piedrasBuy = 0;\n      let piedrasSell = 0;\n      \n      // Procesar cada ingrediente principal\n      for (const ing of TRIBUTO_DRACONICO.mainIngredients) {\n        const result = await renderIngredientRowWithComponents(ing, 0);\n        html += result.html;\n        \n        // Solo sumar tréboles y piedras imán dracónicas\n        if (ing.id === 19675) { // Trébol místico\n          trebolBuy = result.totalBuy || 0;\n          trebolSell = result.totalSell || 0;\n        } else if (ing.id === 92687) { // Piedra imán dracónica amalgamada (ID corregido)\n          piedrasBuy = result.totalBuy || 0;\n          piedrasSell = result.totalSell || 0;\n        } else {\n        }\n      }\n      \n      // Sumar solo los 38 tréboles y 5 piedras imán dracónicas\n      totalBuy = trebolBuy + piedrasBuy;\n      totalSell = trebolSell + piedrasSell;\n      \n      \n      html += `</tbody></table>`;\n      html += `<div class=\"table-modern-totales\" style=\"margin-bottom:50px;\">\n        <div class=\"precio-totales-dones\">\n          <div class=\"total-dones\"><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n          <div class=\"total-dones\"><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n        </div>\n      </div>`;\n      document.getElementById('tributo-draconico-content').insertAdjacentHTML('beforeend', html);\n    }\n    for (const don of TRIBUTO_DRACONICO.dons) {\n      const donDiv = document.createElement('div');\n      donDiv.className = 'don-section';\n      const donTitle = document.createElement('h3');\n      donTitle.textContent = don.name;\n      donDiv.appendChild(donTitle);\n      for (const subdon of don.subdons) {\n        const subdonDiv = document.createElement('div');\n        subdonDiv.className = 'subdon-section';\n        const subdonTitle = document.createElement('h4');\n        subdonTitle.textContent = subdon.name;\n        subdonDiv.appendChild(subdonTitle);\n        // Obtener datos de ingredientes\n        const ingredientes = await Promise.all(subdon.ingredients.map(async ing => {\n          const [info, price] = await Promise.all([\n            fetchItemData(ing.id),\n            fetchPriceData(ing.id)\n          ]);\n          return {\n            id: ing.id,\n            name: info.name,\n            icon: info.icon,\n            count: ing.count,\n            priceBuy: price ? price.buys.unit_price : null,\n            priceSell: price ? price.sells.unit_price : null\n          };\n        }));\n        // Renderizar tabla con lógica tradicional\n        let totalBuy = 0;\n        let totalSell = 0;\n        let rowsHtml = '';\n        ingredientes.forEach((ing, idx) => {\n          const totalBuyIng = ing.priceBuy ? ing.priceBuy * ing.count : null;\n          const totalSellIng = ing.priceSell ? ing.priceSell * ing.count : null;\n          if (totalBuyIng) totalBuy += totalBuyIng;\n          if (totalSellIng) totalSell += totalSellIng;\n          rowsHtml += `\n            <tr data-id='${ing.id}' class='${idx % 2 === 0 ? 'row-bg-a' : 'row-bg-b'}'>\n              <td><img src='${ing.icon}' style='height:28px;'></td>\n              <td>${ing.name}</td>\n              <td>${Math.round(ing.count)}</td>\n              <td>${ing.priceBuy ? formatGoldColored(ing.priceBuy) : '-'}</td>\n              <td>${ing.priceSell ? formatGoldColored(ing.priceSell) : '-'}</td>\n              <td>${totalBuyIng ? formatGoldColored(totalBuyIng) : '-'}</td>\n              <td>${totalSellIng ? formatGoldColored(totalSellIng) : '-'}</td>\n            </tr>`;\n        });\n\n        const tableHtml = `<table class='table-modern-dones tabla-tarjetas'>\n          <thead class='header-items'><tr><th>Ícono</th><th>Nombre</th><th>Cantidad</th><th>Precio Compra (u)</th><th>Precio Venta (u)</th><th>Total Compra</th><th>Total Venta</th></tr></thead>\n          <tbody>${rowsHtml}</tbody>\n        </table>`;\n        subdonDiv.insertAdjacentHTML('beforeend', tableHtml);\n\n        const totalsHtml = `<div class='table-modern-totales' style='margin-bottom:50px;'>\n          <div class='precio-totales-dones'>\n            <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n            <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n          </div>\n        </div>`;\n        subdonDiv.insertAdjacentHTML('beforeend', totalsHtml);\n        donDiv.appendChild(subdonDiv);\n      }\n      container.appendChild(donDiv);\n    }\n  } catch (e) {\n    container.innerHTML = '<div class=\"error-message\">Error al cargar el Tributo Dracónico.</div>';\n  } finally {\n    hideSkeleton(tributoDraconicoSkeleton);\n  }\n}\n\n\n\n// === Tributo Místico ===\nconst TRIBUTO = {\n  name: \"Tributo Místico\",\n  mainIngredients: [\n    { id: 19675, name: \"Trébol místico\", type: \"account_bound\", count: 77, components: [\n  { id: 19976, name: \"Moneda mística\", count: 250 },\n  { id: 19721, name: \"Pegote de ectoplasma\", count: 250 },\n  { id: 19925, name: \"Esquirla de obsidiana\", count: 250 },\n  { id: 20796, name: \"Piedra filosofal\", count: 1500 }\n]},\n    { id: 19976, name: \"Moneda mística\", count: 250 }\n  ],\n  dons: [\n    {\n      name: \"Don de magia condensada\",\n      subdons: [\n        {\n          name: \"Don de sangre\",\n          ingredients: [\n            { id: 24295, name: \"Vial de sangre poderosa\", count: 100 },\n            { id: 24294, name: \"Vial de sangre potente\", count: 250 },\n            { id: 24293, name: \"Vial de sangre espesa\", count: 50 },\n            { id: 24292, name: \"Vial de sangre\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de veneno\",\n          ingredients: [\n            { id: 24283, name: \"Vesícula de veneno poderoso\", count: 100 },\n            { id: 24282, name: \"Vesícula de veneno potente\", count: 250 },\n            { id: 24281, name: \"Vesícula de veneno llena\", count: 50 },\n            { id: 24280, name: \"Vesícula de veneno\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de tótems\",\n          ingredients: [\n            { id: 24300, name: \"Tótem elaborado\", count: 100 },\n            { id: 24299, name: \"Tótem intrincado\", count: 250 },\n            { id: 24298, name: \"Tótem grabado\", count: 50 },\n            { id: 24297, name: \"Tótem\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de polvo\",\n          ingredients: [\n            { id: 24277, name: \"Montón de polvo cristalino\", count: 100 },\n            { id: 24276, name: \"Montón de polvo incandescente\", count: 250 },\n            { id: 24275, name: \"Montón de polvo luminoso\", count: 50 },\n            { id: 24274, name: \"Montón de polvo radiante\", count: 50 },\n          ]\n        },\n      ]\n    },\n    {\n      name: \"Don de poder condensado\",\n      subdons: [\n        {\n          name: \"Don de garras\",\n          ingredients: [\n            { id: 24351, name: \"Garra despiadada\", count: 100 },\n            { id: 24350, name: \"Garra grande\", count: 250 },\n            { id: 24349, name: \"Garra afilada\", count: 50 },\n            { id: 24348, name: \"Garra\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de escamas\",\n          ingredients: [\n            { id: 24289, name: \"Escama blindada\", count: 100 },\n            { id: 24288, name: \"Escama grande\", count: 250 },\n            { id: 24287, name: \"Escama suave\", count: 50 },\n            { id: 24286, name: \"Escama\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de huesos\",\n          ingredients: [\n            { id: 24358, name: \"Hueso antiguo\", count: 100 },\n            { id: 24341, name: \"Hueso grande\", count: 250 },\n            { id: 24345, name: \"Hueso pesado\", count: 50 },\n            { id: 24344, name: \"Hueso\", count: 50 },\n          ]\n        },\n        {\n          name: \"Don de colmillos\",\n          ingredients: [\n            { id: 24357, name: \"Colmillo feroz\", count: 100 },\n            { id: 24356, name: \"Colmillo grande\", count: 250 },\n            { id: 24355, name: \"Colmillo afilado\", count: 50 },\n            { id: 24354, name: \"Colmillo\", count: 50 },\n          ]\n        },\n      ]\n    }\n  ]\n};\n\n// === Tributo Dracónico ===\nconst TRIBUTO_DRACONICO = {\n  name: \"Tributo dracónico\",\n  mainIngredients: [\n    { id: 19675, name: \"Trébol místico\", type: \"account_bound\", count: 38, components: [\n  { id: 19976, name: \"Moneda mística\", count: 38 },\n  { id: 19721, name: \"Pegote de ectoplasma\", count: 38 },\n  { id: 19925, name: \"Esquirla de obsidiana\", count: 38 },\n  { id: 20796, name: \"Piedra filosofal\", count: 228 }\n]},\n    { id: 92687, name: \"Piedra imán dracónica amalgamada\", count: 5 }\n  ],\n  dons: [\n    {\n      name: \"Don de magia condensada\",\n      subdons: [\n        {\n          name: \"Don de sangre\",\n          ingredients: [\n            { id: 24295, name: \"Vial de sangre poderosa\", count: 100 },\n            { id: 24294, name: \"Vial de sangre potente\", count: 250 },\n            { id: 24293, name: \"Vial de sangre espesa\", count: 50 },\n            { id: 24292, name: \"Vial de sangre\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de veneno\",\n          ingredients: [\n            { id: 24283, name: \"Vesícula de veneno poderoso\", count: 100 },\n            { id: 24282, name: \"Vesícula de veneno potente\", count: 250 },\n            { id: 24281, name: \"Vesícula de veneno llena\", count: 50 },\n            { id: 24280, name: \"Vesícula de veneno\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de tótems\",\n          ingredients: [\n            { id: 24300, name: \"Tótem elaborado\", count: 100 },\n            { id: 24299, name: \"Tótem intrincado\", count: 250 },\n            { id: 24298, name: \"Tótem grabado\", count: 50 },\n            { id: 24297, name: \"Tótem\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de polvo\",\n          ingredients: [\n            { id: 24277, name: \"Montón de polvo cristalino\", count: 100 },\n            { id: 24276, name: \"Montón de polvo incandescente\", count: 250 },\n            { id: 24275, name: \"Montón de polvo luminoso\", count: 50 },\n            { id: 24274, name: \"Montón de polvo radiante\", count: 50 }\n          ]\n        }\n      ]\n    },\n    {\n      name: \"Don de poder condensado\",\n      subdons: [\n        {\n          name: \"Don de garras\",\n          ingredients: [\n            { id: 24351, name: \"Garra despiadada\", count: 50 },\n            { id: 24350, name: \"Garra grande\", count: 250 },\n            { id: 24349, name: \"Garra afilada\", count: 50 },\n            { id: 24348, name: \"Garra\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de escamas\",\n          ingredients: [\n            { id: 24289, name: \"Escama blindada\", count: 50 },\n            { id: 24288, name: \"Escama grande\", count: 250 },\n            { id: 24287, name: \"Escama suave\", count: 50 },\n            { id: 24286, name: \"Escama\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de huesos\",\n          ingredients: [\n            { id: 24358, name: \"Hueso antiguo\", count: 50 },\n            { id: 24341, name: \"Hueso grande\", count: 250 },\n            { id: 24345, name: \"Hueso pesado\", count: 50 },\n            { id: 24344, name: \"Hueso\", count: 50 }\n          ]\n        },\n        {\n          name: \"Don de colmillos\",\n          ingredients: [\n            { id: 24357, name: \"Colmillo feroz\", count: 50 },\n            { id: 24356, name: \"Colmillo grande\", count: 250 },\n            { id: 24355, name: \"Colmillo afilado\", count: 50 },\n            { id: 24354, name: \"Colmillo\", count: 50 }\n          ]\n        }\n      ]\n    }\n  ]\n};\n\n// Renderiza una fila y sus subcomponentes recursivamente\n// Devuelve un objeto con {html, totalBuy, totalSell}\nasync function renderIngredientRowWithComponents(ing, level = 0) {\n  const { tree } = await buildWorkerTree([ing]);\n  const node = tree[0];\n  const html = renderNodeHtml(node, level);\n  return { html, totalBuy: node.total_buy || 0, totalSell: node.total_sell || 0 };\n}\n\n// Construye un árbol de componentes completo y unificado para el Tributo Místico\nfunction buildTributoTree() {\n  const root = {\n    id: 'TRIBUTO_MISTICO_ROOT',\n    name: TRIBUTO.name,\n    count: 1,\n    components: []\n  };\n\n  // 1. Añadir ingredientes principales (Trébol Místico)\n  // renderIngredientRowWithComponents se encargará de sus sub-componentes\n  TRIBUTO.mainIngredients.forEach(ing => {\n    root.components.push({ ...ing });\n  });\n\n  // 2. Procesar los dones principales (Magia y Poder Condensado)\n  TRIBUTO.dons.forEach(don => {\n        const donCount = (don.name.toLowerCase().includes('magia condensada') || don.name.toLowerCase().includes('poder condensado')) ? 2 : 1;\n    const donNode = {\n      id: don.name.replace(/\\s+/g, '_').toUpperCase(), // ID único para el don\n      name: don.name,\n      count: donCount,\n      components: []\n    };\n\n    // 3. Procesar los subdones (Sangre, Veneno, etc.)\n    don.subdons.forEach(subdon => {\n      const subdonNode = {\n        id: subdon.name.replace(/\\s+/g, '_').toUpperCase(), // ID único para el subdon\n        name: subdon.name,\n        count: 1,\n        components: []\n      };\n      \n      // 4. Añadir los ingredientes finales al subdon\n      subdon.ingredients.forEach(ingredient => {\n        subdonNode.components.push({ ...ingredient });\n      });\n      \n      donNode.components.push(subdonNode);\n    });\n    \n    root.components.push(donNode);\n  });\n\n  return root;\n}\n\n\n// Renderiza el Tributo Místico como un árbol único y anidado\nasync function renderTributo() {\n  const container = document.getElementById('tributo-content');\n  const skeleton = document.getElementById('tributo-skeleton');\n  if (!container || !skeleton) return;\n\n  showSkeleton(skeleton);\n  container.innerHTML = ''; // Limpiar contenido previo\n\n  try {\n    const tributoTree = buildTributoTree();\n\n    let html = `<h2>${tributoTree.name}</h2>`;\n    html += `<table class='table-modern-dones tabla-tarjetas'>\n      <thead class='header-items'>\n        <tr>\n          <th>Ícono</th>\n          <th>Nombre</th>\n          <th>Cantidad</th>\n          <th>Precio Compra (u)</th>\n          <th>Precio Venta (u)</th>\n          <th>Total Compra</th>\n          <th>Total Venta</th>\n        </tr>\n      </thead>\n      <tbody>`;\n\n    let totalBuy = 0;\n    let totalSell = 0;\n\n    // Renderizar cada componente de nivel superior del árbol de forma recursiva\n    for (const component of tributoTree.components) {\n      const result = await renderIngredientRowWithComponents(component, 0); // Iniciar en nivel 0\n      html += result.html;\n      totalBuy += result.totalBuy || 0;\n      totalSell += result.totalSell || 0;\n    }\n\n    html += `</tbody></table>`;\n\n    // Mostrar los totales generales\n    html += `<div class='table-modern-totales' style='margin-bottom:18px;'>\n      <div class='precio-totales-dones'>\n        <div class='total-dones'><b>Total Compra estimado:</b> ${formatGoldColored(totalBuy)}</div>\n        <div class='total-dones'><b>Total Venta estimado:</b> ${formatGoldColored(totalSell)}</div>\n      </div>\n    </div>`;\n\n    container.innerHTML = html;\n\n  } catch (error) {\n    console.error(\"Error al renderizar Tributo Místico:\", error);\n    container.innerHTML = '<div class=\"error-message\">Error al cargar el Tributo Místico.</div>';\n  } finally {\n    hideSkeleton(skeleton);\n  }\n}\n\n\n"],"names":["DONES","id","name","mainIngredients","type","count","components","manualIngredients","document","getElementById","donesSkeleton","errorMsg","window","showSkeleton","hideSkeleton","donesWorkerInstance","costsWorkerInstance","async","buildWorkerTree","ings","ingredientTree","rootIngredients","Worker","URL","url","Promise","resolve","reject","handleMessage","e","removeEventListener","handleError","data","err","innerText","message","style","display","terminate","addEventListener","postMessage","updatedTree","totals","globalQty","runCostsWorker","restoreCraftIngredientPrototypes","tree","renderNodeHtml","node","level","indent","priceBuy","buy_price","formatGoldColored","priceSell","sell_price","totalBuy","total_buy","totalSell","total_sell","rowHtml","icon","Math","round","Array","isArray","children","child","renderDon","don","container","fetchItemData","fetchPriceData","DonesCore","targetContainer","innerHTML","donName","donIcon","donInfo","primerIng","html","nombre","toLowerCase","esDonSimple","includes","length","ing","result","renderIngredientRowWithComponents","renderLegendaryWeaponGifts","skeleton","gifts","LEGENDARY_ITEMS","LegendaryData","seen","Set","item","Object","values","gift","find","c","lower","startsWith","has","add","push","sort","a","b","localeCompare","extractWeaponGifts","btnsDiv","createElement","className","resultDiv","forEach","btn","textContent","querySelectorAll","classList","remove","appendChild","error","console","renderDraconicTribute","tributoTree","LEGENDARY_ITEMS_3GEN","weapon","tribute","Error","getDraconicTribute","component","_loadedTabs","special","tributo","draco","gen1","loadSpecialDons","specialDons","filter","d","donContainer","renderSpecialDons","loadTributo","root","TRIBUTO","dons","donCount","donNode","replace","toUpperCase","subdons","subdon","subdonNode","ingredients","ingredient","buildTributoTree","renderTributo","loadDraconicTribute","loadDones1Gen","init","DonesPages"],"mappings":"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"}